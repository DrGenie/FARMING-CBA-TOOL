<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Farming CBA Decision Tool 2</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />

  <!-- Excel library for reading and writing .xlsx files -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div>
        <h1>Farming CBA Decision Tool 2</h1>
        <p class="subtitle">
          Upload your actual farm CBA dataset, configure the scenario, and compare treatments by NPV, BCR, and ROI.
        </p>
      </div>
      <div class="header-actions">
        <button type="button" class="btn btn-secondary" id="btn-print">
          Print / Save PDF
        </button>
      </div>
    </header>

    <nav class="tabs-nav">
      <button class="tab-button active" data-tab="scenario">1. Scenario &amp; Upload</button>
      <button class="tab-button" data-tab="treatments">2. Treatments</button>
      <button class="tab-button" data-tab="results">3. Results</button>
      <button class="tab-button" data-tab="ai-helper">4. AI helper</button>
    </nav>

    <main class="tabs-container">
      <!-- SCENARIO TAB -->
      <section class="tab-panel active" data-tab="scenario">
        <div class="card-grid">
          <section class="card">
            <h2>Scenario settings</h2>
            <p class="section-intro">
              These settings apply to all treatments. Adjust them to match your farm and analysis assumptions.
            </p>
            <div class="form-grid">
              <div class="form-field">
                <label for="input-area">
                  Farm area (ha)
                  <span class="tooltip-icon" data-tooltip="Total cropped area in hectares used to scale whole-farm NPVs.">?</span>
                </label>
                <input id="input-area" type="number" step="1" min="1" />
              </div>

              <div class="form-field">
                <label for="input-horizon">
                  Time horizon (years)
                  <span class="tooltip-icon" data-tooltip="Number of years over which benefits and costs are discounted.">?</span>
                </label>
                <input id="input-horizon" type="number" step="1" min="1" />
              </div>

              <div class="form-field">
                <label for="input-discount">
                  Discount rate (%)
                  <span class="tooltip-icon" data-tooltip="Annual discount rate used to convert future amounts into present values.">?</span>
                </label>
                <input id="input-discount" type="number" step="0.1" min="0" />
              </div>

              <div class="form-field">
                <label for="input-price">
                  Default grain price ($/t)
                  <span class="tooltip-icon" data-tooltip="Price per tonne used when a treatment does not specify its own price.">?</span>
                </label>
                <input id="input-price" type="number" step="1" min="0" />
              </div>
            </div>
          </section>

          <section class="card">
            <h2>Upload actual CBA dataset</h2>
            <p class="section-intro">
              Upload the Excel file with your farm CBA data. The tool reads the dataset exactly as it is.
              Required columns in the first sheet:
              <strong>Amendment</strong>,
              <strong>Yield t/ha</strong>,
              <strong>Treatment Input Cost Only /Ha</strong>.
            </p>
            <div class="upload-block">
              <input id="input-upload" type="file" accept=".xlsx,.xls" />
              <p id="upload-status" class="upload-status">
                No file uploaded yet.
              </p>
              <p class="hint">
                No editing, no changes, no omissions: the tool uses your actual dataset. It groups rows by
                <strong>Amendment</strong> and averages yield and treatment input costs per hectare.
              </p>
            </div>
          </section>
        </div>
      </section>

      <!-- TREATMENTS TAB -->
      <section class="tab-panel" data-tab="treatments">
        <section class="card">
          <div class="card-header-inline">
            <h2>Treatments and cost components</h2>
            <button type="button" class="btn btn-primary" id="btn-add-treatment">
              + Add treatment
            </button>
          </div>
          <p class="section-intro">
            Edit treatment names, mark the control, and adjust yields, prices, and cost components.
            All calculations update automatically.
          </p>
          <div class="table-wrapper">
            <table id="treatments-table" class="data-table">
              <thead>
                <tr>
                  <th>Treatment name</th>
                  <th>Control?</th>
                  <th>Yield (t/ha)</th>
                  <th>Price ($/t)</th>
                  <th>Capital cost Year 0 ($/ha)</th>
                  <th>Seed / fertiliser ($/ha)</th>
                  <th>Chemicals ($/ha)</th>
                  <th>Labour ($/ha)</th>
                  <th>Machinery ($/ha)</th>
                  <th>Other costs ($/ha)</th>
                  <th>Total annual costs ($/ha)</th>
                  <th>Extra benefits ($/ha)</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <!-- Filled dynamically -->
              </tbody>
            </table>
          </div>
          <p class="hint">
            Annual costs per hectare are discounted over the time horizon.
            Capital costs are treated as a one-off cost in year 0.
          </p>
        </section>
      </section>

      <!-- RESULTS TAB -->
      <section class="tab-panel" data-tab="results">
        <section class="card">
          <div class="card-header-inline">
            <h2>Economic results</h2>
            <div class="card-header-actions">
              <button type="button" class="btn btn-secondary" id="btn-export-excel">
                Export to Excel
              </button>
              <button type="button" class="btn btn-secondary" id="btn-print-2">
                Print / Save PDF
              </button>
            </div>
          </div>
          <div id="summary-block" class="summary-block">
            <!-- Summary filled by JS -->
          </div>
          <div id="results-table-container" class="table-wrapper">
            <!-- Results table filled by JS -->
          </div>
        </section>
      </section>

      <!-- AI HELPER TAB -->
      <section class="tab-panel" data-tab="ai-helper">
        <section class="card">
          <h2>AI helper prompt</h2>
          <p class="section-intro">
            This prompt summarises your scenario and results. Copy and paste it into your preferred AI
            assistant to generate a farmer-friendly interpretation (2â€“3 pages).
          </p>
          <div class="ai-toolbar">
            <button type="button" class="btn btn-primary" id="btn-refresh-prompt">
              Refresh from results
            </button>
            <button type="button" class="btn btn-secondary" id="btn-copy-prompt">
              Copy to clipboard
            </button>
            <button type="button" class="btn btn-secondary" id="btn-download-prompt">
              Download .txt
            </button>
          </div>
          <textarea id="ai-prompt" class="ai-textarea" rows="18"></textarea>
          <p class="hint">
            If you change scenario settings or treatment data, click
            <strong>Refresh from results</strong> before copying the prompt.
          </p>
        </section>
      </section>
    </main>
  </div>

  <script src="app.js"></script>
</body>
</html>
