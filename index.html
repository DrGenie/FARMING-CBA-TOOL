<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Farming CBA Decision Aid - Newcastle Business School</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Control centred farm cost benefit analysis tool with clear comparison of treatments, sensitivity checks and lay friendly summary." />
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="brand">
        <div class="brand-mark">F</div>
        <div class="brand-text">
          <div class="brand-title">Farming CBA Decision Aid</div>
          <div class="brand-subtitle">Newcastle Business School | World Bank style layout</div>
        </div>
      </div>
      <div class="header-meta">
        <div class="dataset-pill">
          <span class="label">Dataset</span>
          <span class="value" id="datasetNameBadge">Default trial loaded</span>
        </div>
      </div>
    </header>

    <nav class="tabs" aria-label="Main sections">
      <button class="tab active" type="button" data-tab-target="tab-intro">Overview</button>
      <button class="tab" type="button" data-tab-target="tab-data">Data and import</button>
      <button class="tab" type="button" data-tab-target="tab-treatments">Treatments</button>
      <button class="tab" type="button" data-tab-target="tab-sensitivity">Sensitivity</button>
      <button class="tab" type="button" data-tab-target="tab-results">Results</button>
      <button class="tab" type="button" data-tab-target="tab-ai">AI briefing</button>
      <button class="tab" type="button" data-tab-target="tab-appendix">Technical appendix</button>
    </nav>

    <main class="tab-panels">
      <!-- Overview -->
      <section id="tab-intro" class="tab-panel active" role="tabpanel" aria-labelledby="tab-overview">
        <div class="page">
          <section class="card">
            <h1>What this tool does</h1>
            <p>
              This decision aid helps you compare farm treatments against a clear control. It translates trial data into standard cost benefit indicators so that farmers and policy teams can see which options offer the strongest value.
            </p>
            <p>
              The tool uses a control centred design. Present value of benefits, present value of costs, net present value, benefit cost ratio and return on investment are all lined up across treatments next to the control. Change in net present value and change in present value of costs relative to the control are highlighted so that it is simple to see whether a treatment wins by higher benefits, lower costs or both.
            </p>
          </section>

          <section class="card">
            <h2>How to use the tool</h2>
            <p><strong>Step 1.</strong> Review the default trial data under the Data and import tab. If needed, download a template, update it in Excel and upload it back into the tool.</p>
            <p><strong>Step 2.</strong> Under the Treatments tab, confirm which treatment is the control and check the summary measures that have been derived from the plot level data.</p>
            <p><strong>Step 3.</strong> Under the Sensitivity tab, adjust the discount rate band if required. This will show how results change under low, base and high discount rate settings.</p>
            <p><strong>Step 4.</strong> Under the Results tab, use the leaderboard and the comparison to control table to see which treatments are most attractive. You can export clean tables for Excel and for reports.</p>
            <p><strong>Step 5.</strong> Under the AI briefing tab, you can copy a short prompt that describes the results in plain language. This can be pasted into a separate AI assistant to draft a policy note or farmer guide.</p>
          </section>
        </div>
      </section>

      <!-- Data and import -->
      <section id="tab-data" class="tab-panel" role="tabpanel">
        <div class="page">
          <section class="card">
            <h2>Data import</h2>
            <p>
              The tool works with simple table data. You can use the default trial that is already loaded, or you can upload your own file. The parser can handle Excel files, comma separated files and tab separated files. The first row must contain column names.
            </p>

            <div class="grid two-col" style="margin-top:10px;">
              <div class="field-group">
                <div class="field-row">
                  <label for="fileInput">Upload Excel, CSV or TSV file</label>
                  <input id="fileInput" type="file" accept=".xlsx,.xls,.csv,.tsv,.txt" />
                </div>
                <div class="button-row">
                  <button type="button" class="btn btn-primary" id="btnParseFile">Read file</button>
                  <button type="button" class="btn" id="btnLoadDefault">Reload default trial data</button>
                </div>
                <p class="small muted">
                  The tool will try to detect treatment, control status, year, benefit and cost from the column names. You can check the mapping in the summary box below.
                </p>
              </div>

              <div class="field-group">
                <div class="field-row">
                  <label for="pasteInput">Or paste table data from Excel</label>
                  <textarea id="pasteInput" placeholder="Paste rows copied from your spreadsheet. The first row should contain the column names."></textarea>
                </div>
                <div class="button-row">
                  <button type="button" class="btn btn-primary" id="btnParsePaste">Read pasted table</button>
                </div>
                <p class="small muted">
                  This is useful if you want to test a quick scenario without saving a file.
                </p>
              </div>
            </div>

            <div class="commit-row">
              <button type="button" class="btn btn-strong" id="btnCommitData">Commit data to analysis</button>
              <span class="small muted" style="margin-left:8px;">
                Commit after you are happy with the detected columns and checks.
              </span>
            </div>
          </section>

          <section class="card">
            <h2>Import summary and checks</h2>
            <div id="importSummary" class="import-summary">
              No data has been parsed yet. The default dataset is active in the background. Use the buttons above to read a file or pasted table if you want to replace it.
            </div>
            <div id="dataChecks"></div>
          </section>
        </div>
      </section>

      <!-- Treatments -->
      <section id="tab-treatments" class="tab-panel" role="tabpanel">
        <div class="page">
          <section class="card">
            <h2>Treatment overview</h2>
            <p>
              This section summarises how many plots are available for each treatment and whether a treatment is flagged as the control. Yield and cost statistics are calculated using only valid observations so that missing values never distort results.
            </p>
          </section>

          <section class="card">
            <h3>Derived treatment summaries</h3>
            <div id="treatmentsList">
              <p class="small muted">
                Once data has been committed, each treatment will appear here with basic summary statistics drawn from the plot level dataset.
              </p>
            </div>
          </section>
        </div>
      </section>

      <!-- Sensitivity -->
      <section id="tab-sensitivity" class="tab-panel" role="tabpanel">
        <div class="page">
          <section class="card">
            <h2>Discount rate sensitivity</h2>
            <p>
              Benefit and cost flows are discounted over time. This panel lets you test how sensitive the ranking of treatments is to the choice of discount rate. The base rate should reflect your preferred social discount rate. The low and high values should capture a reasonable range for testing.
            </p>

            <div class="grid two-col" style="margin-top:10px;">
              <div class="field-group">
                <div class="field-row">
                  <label for="discountBaseInput">Base discount rate (percent per year)</label>
                  <input id="discountBaseInput" type="number" step="0.1" min="0" max="50" value="4" />
                </div>
                <div class="field-row">
                  <label for="discountLowInput">Low discount rate (percent per year)</label>
                  <input id="discountLowInput" type="number" step="0.1" min="0" max="50" value="2" />
                </div>
                <div class="field-row">
                  <label for="discountHighInput">High discount rate (percent per year)</label>
                  <input id="discountHighInput" type="number" step="0.1" min="0" max="50" value="6" />
                </div>
                <div class="button-row">
                  <button type="button" class="btn btn-primary" id="btnRunSensitivity">Run sensitivity</button>
                </div>
              </div>

              <div class="field-group">
                <label>Sensitivity summary</label>
                <div id="sensitivitySummary">
                  Once you run the sensitivity analysis, this box will describe which treatments remain strong across low, base and high discount rates and whether any treatment only looks attractive under a narrow set of assumptions.
                </div>
              </div>
            </div>
          </section>
        </div>
      </section>

      <!-- Results -->
      <section id="tab-results" class="tab-panel" role="tabpanel">
        <div class="page">
          <section class="card">
            <h2>Snapshot of performance</h2>
            <p>
              The table below lists each treatment, its net present value, benefit cost ratio and return on investment under the base discount rate. The treatment ranked first has the highest net present value. The control is included in the same list so that you can see how far it sits from the alternatives.
            </p>

            <div class="results-controls">
              <div class="field-row quick-filters">
                <span class="label">Quick view filters</span>
              </div>
              <div class="button-row">
                <button type="button" class="btn btn-ghost" id="btnFilterTopNPV">Top five by net present value</button>
                <button type="button" class="btn btn-ghost" id="btnFilterTopBCR">Top five by benefit cost ratio</button>
                <button type="button" class="btn btn-ghost" id="btnFilterImprovements">Treatments that improve on control</button>
                <button type="button" class="btn btn-ghost" id="btnFilterAll">Show all treatments</button>
              </div>
            </div>

            <div id="resultsLeaderboard"></div>
          </section>

          <section class="card">
            <h3>Comparison to control</h3>
            <p>
              This comparison table is the core of the decision aid. Indicators are in rows. The control and all treatments are in columns. For each treatment the table shows the level of each indicator and the change from the control. Positive changes in net present value and benefit cost ratio are highlighted.
            </p>

            <div class="results-exports">
              <button type="button" class="btn" id="btnExportSummaryCsv">Export summary table (CSV)</button>
              <button type="button" class="btn" id="btnExportComparisonCsv">Export comparison to control (CSV)</button>
              <button type="button" class="btn" id="btnExportSensitivityCsv">Export sensitivity grid (CSV)</button>
              <button type="button" class="btn" id="btnPrintView">Print or save as PDF</button>
            </div>

            <div id="comparisonToControl"></div>

            <div style="margin-top:10px;">
              <label class="small muted">Plain language explanation</label>
              <div id="resultsNarrative" class="narrative-block">
                When data has been committed and indicators are calculated, this section will describe in clear language how each treatment compares with the control, which treatment appears most attractive and how large the differences are in currency terms.
              </div>
            </div>
          </section>
        </div>
      </section>

      <!-- AI briefing -->
      <section id="tab-ai" class="tab-panel" role="tabpanel">
        <div class="page">
          <section class="card">
            <h2>AI ready briefing text</h2>
            <p>
              This panel prepares a compact description of the current scenario and results. You can copy the text below and paste it into a separate AI assistant such as Copilot or another service. Ask it to draft a short policy note or farmer guide based on this description.
            </p>

            <div class="button-row" style="margin-bottom:8px;">
              <button type="button" class="btn btn-primary" id="btnRefreshBriefing">Refresh briefing text</button>
              <button type="button" class="btn" id="btnCopyBriefing">Copy briefing text</button>
            </div>

            <textarea id="aiBriefingText" rows="10" spellcheck="false"></textarea>
          </section>

          <section class="card">
            <h3>Results JSON for advanced use</h3>
            <p class="small muted">
              This section provides a machine readable summary of the main indicators. It can be copied into advanced notebooks or other tools if you want to run further analysis.
            </p>

            <div class="button-row" style="margin-bottom:8px;">
              <button type="button" class="btn" id="btnRefreshJson">Refresh JSON snapshot</button>
              <button type="button" class="btn" id="btnCopyJson">Copy JSON</button>
            </div>

            <textarea id="resultsJson" rows="10" spellcheck="false"></textarea>
          </section>
        </div>
      </section>

      <!-- Technical appendix -->
      <section id="tab-appendix" class="tab-panel" role="tabpanel">
        <div class="page">
          <section class="card">
            <h2>Technical appendix</h2>
            <p>
              The cost benefit calculations follow standard economic practice. For each treatment, benefits and costs are summed over years using a constant annual discount rate. Year zero values are not discounted. An annual rate r turns a flow in year t into a present value of flow divided by (1 plus r) to the power of t.
            </p>
            <p>
              Net present value is the present value of benefits minus the present value of costs. The benefit cost ratio is the present value of benefits divided by the present value of costs. Return on investment is net present value divided by the present value of costs and can be interpreted as a percentage gain relative to the scale of investment.
            </p>
            <p>
              The tool treats missing values as genuinely missing rather than zero. Summary statistics are based only on valid observations. Control treatment identification and mapping of columns from the raw dataset are recorded in the import summary and checks panel so that users can see how the tool has interpreted their dataset.
            </p>
          </section>
        </div>
      </section>
    </main>
  </div>

  <div id="toastHost" class="toast-host" aria-live="polite" aria-atomic="true"></div>

  <script src="app.js"></script>
</body>
</html>
