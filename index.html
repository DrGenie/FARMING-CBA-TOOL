<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Farming CBA Decision Tool 2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="app-header-main">
        <h1>Farming CBA Decision Tool 2</h1>
        <p class="app-tagline">
          Compare present value (PV) benefits and costs across farm treatments, using results already calculated in Excel.
        </p>
      </div>
      <div class="app-header-meta">
        <div class="badge badge-primary">Snapshot-first</div>
        <div class="badge badge-soft">Excel-first workflow</div>
        <div class="badge badge-soft">Farmer-friendly outputs</div>
      </div>
    </header>

    <nav class="tab-nav" aria-label="Main sections">
      <button class="tab-button active" data-tab-target="inputs">1. Inputs</button>
      <button class="tab-button" data-tab-target="results">2. Results matrix</button>
      <button class="tab-button" data-tab-target="snapshot">3. Snapshot &amp; print</button>
      <button class="tab-button" data-tab-target="excel">4. Excel &amp; export</button>
      <button class="tab-button" data-tab-target="ai-helper">5. AI helper</button>
    </nav>

    <main class="app-main">
      <!-- INPUTS TAB -->
      <section id="tab-inputs" class="tab-panel active" aria-label="Inputs">
        <div class="layout-two-col">
          <section class="card">
            <header class="card-header">
              <h2>1. Farm and analysis settings</h2>
            </header>
            <div class="card-body grid-form">
              <div class="form-group">
                <label for="farmName">
                  Farm / project name
                  <span class="tooltip" data-tooltip="Optional label shown on snapshots and exports.">
                    ?
                  </span>
                </label>
                <input id="farmName" type="text" placeholder="e.g. North paddock upgrade" />
              </div>

              <div class="form-group">
                <label for="timeHorizon">
                  Time horizon used in Excel (years)
                  <span class="tooltip" data-tooltip="Number of years used when calculating PV benefits and PV costs in your spreadsheet.">
                    ?
                  </span>
                </label>
                <input id="timeHorizon" type="number" min="1" step="1" />
              </div>

              <div class="form-group">
                <label for="discountRate">
                  Discount rate used in Excel (% per year)
                  <span class="tooltip" data-tooltip="The discount rate already used in your PV calculations (e.g. 7%). The tool does not recalculate PVs, it just uses the PV figures you enter.">
                    ?
                  </span>
                </label>
                <input id="discountRate" type="number" min="0" step="0.1" />
              </div>

              <div class="form-group">
                <label for="currency">
                  Currency
                  <span class="tooltip" data-tooltip="Short code or symbol used in your Excel sheet, shown on all outputs.">
                    ?
                  </span>
                </label>
                <input id="currency" type="text" maxlength="6" placeholder="e.g. AUD or $" />
              </div>

              <div class="form-group">
                <label for="notes">
                  Notes for this analysis
                  <span class="tooltip" data-tooltip="Optional short note about assumptions or context. Appears on the snapshot and AI helper tabs.">
                    ?
                  </span>
                </label>
                <textarea id="notes" rows="3" placeholder="Key assumptions, reference to your Excel file, or anything you want to remember."></textarea>
              </div>
            </div>
          </section>

          <section class="card">
            <header class="card-header">
              <h2>2. Quick guidance</h2>
            </header>
            <div class="card-body guidance-text">
              <p>
                This tool summarises <strong>PV benefits</strong> and <strong>PV costs</strong> you have already calculated in Excel.
                It does not change your numbers; it simply:
              </p>
              <ul>
                <li>Calculates <strong>NPV</strong> (PV benefits minus PV costs) for each treatment.</li>
                <li>Calculates <strong>BCR</strong> (PV benefits divided by PV costs).</li>
                <li>Calculates <strong>ROI</strong> (NPV per dollar of PV cost).</li>
                <li>Compares each treatment with the <strong>control</strong>.</li>
              </ul>
              <p>
                Use your Excel workbook to work out PV benefits and PV costs for each treatment, including all components
                such as yield, cost savings, risk reduction, and environmental benefits. Then paste those numbers into the table below.
              </p>
              <p class="muted">
                The tool highlights trade-offs and differences. It does <strong>not</strong> tell you what to choose or set any pass/fail rule.
              </p>
            </div>
          </section>
        </div>

        <section class="card card-wide">
          <header class="card-header">
            <div class="card-header-main">
              <h2>3. PV benefits and PV costs by treatment</h2>
              <p class="card-subtitle">
                Enter PV figures from your Excel sheet. You can add or remove treatments as needed.
              </p>
            </div>
            <div class="card-header-actions">
              <button id="addTreatmentBtn" class="btn btn-secondary" type="button">
                + Add treatment
              </button>
            </div>
          </header>

          <div class="card-body">
            <div class="table-wrapper">
              <table class="table table-input" aria-label="PV inputs per treatment">
                <thead>
                  <tr>
                    <th>Role</th>
                    <th>Treatment name</th>
                    <th>
                      PV benefits: market &amp; yield
                      <span class="tooltip" data-tooltip="PV of extra revenue from yield or price gains. Calculated in Excel.">
                        ?
                      </span>
                    </th>
                    <th>
                      PV benefits: cost savings
                      <span class="tooltip" data-tooltip="PV of reduced input, labour, or maintenance costs. Calculated in Excel.">
                        ?
                      </span>
                    </th>
                    <th>
                      PV benefits: risk &amp; resilience
                      <span class="tooltip" data-tooltip="PV of avoided losses or improved resilience (e.g. fewer crop failures).">
                        ?
                      </span>
                    </th>
                    <th>
                      PV benefits: environmental &amp; other
                      <span class="tooltip" data-tooltip="PV of environmental, soil, or other quantified benefits.">
                        ?
                      </span>
                    </th>
                    <th>
                      PV costs: total
                      <span class="tooltip" data-tooltip="PV of all costs, including upfront capital, operating, and maintenance costs.">
                        ?
                      </span>
                    </th>
                    <th>
                      Remove
                    </th>
                  </tr>
                </thead>
                <tbody id="treatmentsTbody">
                  <!-- Filled by script.js -->
                </tbody>
              </table>
            </div>

            <p class="muted table-hint">
              All PV figures should be in the <strong>same currency</strong> and calculated with the
              <strong>same discount rate and time horizon</strong> you entered above.
            </p>
          </div>
        </section>
      </section>

      <!-- RESULTS TAB -->
      <section id="tab-results" class="tab-panel" aria-label="Results matrix">
        <section class="card card-wide">
          <header class="card-header">
            <div class="card-header-main">
              <h2>Results matrix</h2>
              <p class="card-subtitle">
                Summary of PV benefits, PV costs, NPV, benefit–cost ratio (BCR), and return on investment (ROI).
              </p>
            </div>
            <div class="card-header-actions">
              <button id="refreshResultsBtn" class="btn btn-secondary" type="button">
                Refresh results
              </button>
            </div>
          </header>

          <div class="card-body">
            <div class="summary-strip" id="headlineSummary">
              <!-- Filled by script.js -->
            </div>

            <div class="table-wrapper">
              <table class="table table-results" aria-label="Results matrix">
                <thead>
                  <tr>
                    <th>Role</th>
                    <th>Treatment</th>
                    <th>PV benefits (total)</th>
                    <th>PV costs (total)</th>
                    <th>NPV</th>
                    <th>BCR</th>
                    <th>ROI</th>
                    <th>Δ NPV vs control</th>
                    <th>Δ PV benefits vs control</th>
                    <th>Δ PV costs vs control</th>
                  </tr>
                </thead>
                <tbody id="resultsTbody">
                  <!-- Filled by script.js -->
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </section>

      <!-- SNAPSHOT TAB -->
      <section id="tab-snapshot" class="tab-panel" aria-label="Snapshot and print">
        <section class="card card-wide snapshot-card" id="snapshotCard">
          <header class="card-header">
            <div class="card-header-main">
              <h2>Snapshot summary</h2>
              <p class="card-subtitle">
                Print-friendly summary of the analysis for discussion with farmers and advisers.
              </p>
            </div>
            <div class="card-header-actions">
              <button id="printSnapshotBtn" class="btn btn-primary" type="button">
                Print / Save as PDF
              </button>
            </div>
          </header>

          <div class="card-body snapshot-body">
            <section class="snapshot-section" id="snapshotContext">
              <!-- Filled by script.js -->
            </section>

            <section class="snapshot-section">
              <h3>Headline results</h3>
              <div id="snapshotHeadline">
                <!-- Filled by script.js -->
              </div>
            </section>

            <section class="snapshot-section">
              <h3>Treatment-by-treatment summary</h3>
              <div class="table-wrapper">
                <table class="table table-compact" aria-label="Snapshot results">
                  <thead>
                    <tr>
                      <th>Role</th>
                      <th>Treatment</th>
                      <th>PV benefits</th>
                      <th>PV costs</th>
                      <th>NPV</th>
                      <th>BCR</th>
                      <th>ROI</th>
                    </tr>
                  </thead>
                  <tbody id="snapshotTbody">
                    <!-- Filled by script.js -->
                  </tbody>
                </table>
              </div>
            </section>

            <section class="snapshot-section">
              <h3>How to read these numbers</h3>
              <ul class="snapshot-explainer">
                <li><strong>NPV</strong> is PV benefits minus PV costs. A higher NPV means a larger net gain above the control under your assumptions.</li>
                <li><strong>BCR</strong> is PV benefits divided by PV costs. Values above 1 mean benefits exceed costs, but the size of that margin still matters.</li>
                <li><strong>ROI</strong> is NPV divided by PV costs. It shows the net gain per dollar of PV cost.</li>
                <li>
                  Results depend entirely on the PV figures entered from Excel. If key assumptions change (prices, yields, input costs, failure rates),
                  update the Excel sheet and refresh this tool.
                </li>
                <li>
                  Use these results to discuss trade-offs. They highlight which treatments deliver more or less value, but they do not replace local knowledge,
                  risk preferences, or non-monetary considerations.
                </li>
              </ul>
            </section>
          </div>
        </section>
      </section>

      <!-- EXCEL & EXPORT TAB -->
      <section id="tab-excel" class="tab-panel" aria-label="Excel and export">
        <section class="card card-wide">
          <header class="card-header">
            <div class="card-header-main">
              <h2>Excel link and export</h2>
              <p class="card-subtitle">
                Copy results into Excel or another program, and keep a clean record of your assumptions and outputs.
              </p>
            </div>
            <div class="card-header-actions">
              <button id="copyTsvBtn" class="btn btn-primary" type="button">
                Copy results (tab-separated)
              </button>
            </div>
          </header>

          <div class="card-body">
            <section class="excel-section">
              <h3>Current results table (copy-friendly)</h3>
              <textarea id="excelExportArea" class="excel-textarea" rows="10" spellcheck="false"></textarea>
              <p class="muted">
                Select all and copy, or use the “Copy results” button above. Paste into Excel, Google Sheets, R, or Stata as a tab-separated table.
              </p>
            </section>

            <section class="excel-section">
              <h3>Checklist for your Excel workbook</h3>
              <ul>
                <li>Make sure all PV benefits and PV costs are in the same currency and price year.</li>
                <li>Confirm that the same discount rate and time horizon are used for all treatments.</li>
                <li>Where possible, separate benefits into market, cost savings, risk/resilience, and environmental/other in Excel, then sum to the PV totals used here.</li>
                <li>Keep a clear link between this tool and the exact sheet or file name used for the PV calculations.</li>
              </ul>
            </section>
          </div>
        </section>
      </section>

      <!-- AI HELPER TAB -->
      <section id="tab-ai-helper" class="tab-panel" aria-label="AI helper">
        <section class="card card-wide">
          <header class="card-header">
            <div class="card-header-main">
              <h2>AI helper prompt</h2>
              <p class="card-subtitle">
                Use this text with your preferred AI assistant to generate a two to three page, farmer-friendly interpretation.
              </p>
            </div>
            <div class="card-header-actions">
              <button id="refreshAiHelperBtn" class="btn btn-secondary" type="button">
                Refresh AI prompt
              </button>
            </div>
          </header>

          <div class="card-body">
            <section class="ai-section">
              <h3>Instructions</h3>
              <p>
                The text below summarises your farm, assumptions, and the PV results from this tool. You can copy and paste it into an AI assistant
                and ask for a plain-language explanation of what is driving PV benefits, PV costs, NPV, BCR, and ROI, without telling you which option to choose.
              </p>
            </section>

            <section class="ai-section">
              <h3>Copy-and-paste AI prompt</h3>
              <textarea id="aiHelperArea" class="excel-textarea" rows="14" spellcheck="false"></textarea>
              <p class="muted">
                After making changes to inputs, click “Refresh AI prompt” so the summary stays in sync with your latest results.
              </p>
            </section>
          </div>
        </section>
      </section>
    </main>

    <footer class="app-footer">
      <span class="muted">
        This tool summarises PV results from your own spreadsheets. Check your underlying Excel analysis whenever assumptions change.
      </span>
    </footer>
  </div>

  <!-- Keep this script tag at the end of body, without async/defer -->
  <script src="script.js"></script>
</body>
</html>
