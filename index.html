<!-- index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Farming CBA Decision Tool — Newcastle Business School</title>
  <meta name="description" content="Control-centric farm cost–benefit analysis tool with robust import pipeline, discounted CBA engine, sensitivity analysis, exports, and AI briefing." />

  <link rel="stylesheet" href="styles.css" />

  <!-- Optional: XLSX for workbook export (used only if present) -->
  <script defer src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <script defer src="app.js"></script>
</head>

<body>
  <noscript>
    <div class="page">
      <div class="card">
        <h2>JavaScript is required</h2>
        <p>Please enable JavaScript to use this tool.</p>
      </div>
    </div>
  </noscript>

  <div id="toast-root" aria-live="polite" aria-atomic="true"></div>

  <div class="app-shell">
    <header class="app-header">
      <div class="brand">
        <div class="brand-mark" aria-hidden="true">NBS</div>
        <div class="brand-text">
          <div class="brand-title">Farming CBA Decision Tool</div>
          <div class="brand-subtitle">Newcastle Business School · Control-centric results · Excel-first import</div>
        </div>

        <div class="header-actions">
          <div class="small muted" id="headerDatasetBadge">
            Dataset: <span id="headerDatasetName">Loading default trial dataset…</span>
          </div>
          <button class="btn small" id="loadDefaultDataBtn" type="button" title="Reload the default trial dataset (if the default data file exists in the same folder).">
            Reload default data
          </button>
        </div>
      </div>
    </header>

    <nav class="tabs" role="tablist" aria-label="Tool sections">
      <button class="tab active" type="button" data-tab="results" role="tab" aria-selected="true">Results</button>
      <button class="tab" type="button" data-tab="import" role="tab" aria-selected="false">Data Import</button>
      <button class="tab" type="button" data-tab="config" role="tab" aria-selected="false">Configuration</button>
      <button class="tab" type="button" data-tab="outputs" role="tab" aria-selected="false">Outputs</button>
      <button class="tab" type="button" data-tab="treatments" role="tab" aria-selected="false">Treatments</button>
      <button class="tab" type="button" data-tab="sensitivity" role="tab" aria-selected="false">Sensitivity</button>
      <button class="tab" type="button" data-tab="ai" role="tab" aria-selected="false">AI Briefing</button>
      <button class="tab" type="button" data-tab="intro" role="tab" aria-selected="false">Introduction</button>
      <button class="tab" type="button" data-tab="appendix" role="tab" aria-selected="false" title="Opens the Technical Appendix in a new browser tab.">Technical Appendix</button>
    </nav>

    <main class="tab-panels">
      <!-- RESULTS -->
      <section class="tab-panel active" data-tab-panel="results" id="tab-results" role="tabpanel" aria-hidden="false">
        <div class="page">
          <div class="page-head">
            <h1>Results</h1>
            <div class="page-head-actions">
              <label class="inline-field">
                <span class="label">Quick filter</span>
                <select id="resultsFilter">
                  <option value="all" selected>Show all</option>
                  <option value="top5_npv">Top 5 by NPV</option>
                  <option value="top5_bcr">Top 5 by BCR</option>
                  <option value="improve_only">Show only improvements vs control</option>
                </select>
              </label>

              <div class="btn-row">
                <button class="btn small" id="filterTopNpv" type="button">Top 5 by NPV</button>
                <button class="btn small" id="filterTopBcr" type="button">Top 5 by BCR</button>
                <button class="btn small" id="filterImproveOnly" type="button">Improvements only</button>
                <button class="btn small" id="filterShowAll" type="button">Show all</button>
              </div>
            </div>
          </div>

          <div class="grid three">
            <div class="card">
              <h2>Leaderboard</h2>
              <p class="small muted">
                Ranks treatments by net present value under the current base case assumptions. The control baseline is shown for comparison but not ranked.
              </p>
              <div id="resultsLeaderboard"></div>
            </div>

            <div class="card">
              <h2>What this means</h2>
              <p class="small muted">
                This explanation updates when you import data, change assumptions, or apply a results filter.
              </p>
              <div class="prose" id="resultsNarrative"></div>
            </div>

            <div class="card">
              <div class="card-head">
                <h2>Figures</h2>
                <div class="card-head-actions">
                  <span class="badge" id="figuresBadge">Base case</span>
                </div>
              </div>
              <p class="small muted">
                These charts are designed for quick reading. They always use the same numbers as the table below.
              </p>

              <div class="charts-grid">
                <div class="chart-card">
                  <div class="chart-title">Net present value by treatment</div>
                  <canvas id="chartNpv" height="220" aria-label="NPV bar chart"></canvas>
                  <div class="chart-note small muted">Higher bars mean larger net gains relative to costs under current assumptions.</div>
                </div>

                <div class="chart-card">
                  <div class="chart-title">PV benefits and PV costs</div>
                  <canvas id="chartPv" height="220" aria-label="PV benefits and costs chart"></canvas>
                  <div class="chart-note small muted">Benefits come from yield changes valued at grain price. Costs include year-zero capital plus recurring application costs.</div>
                </div>

                <div class="chart-card">
                  <div class="chart-title">Yield lift and cost per hectare</div>
                  <canvas id="chartYieldCost" height="220" aria-label="Yield and cost chart"></canvas>
                  <div class="chart-note small muted">This is a plain view of what drives outcomes: yield difference and extra cost.</div>
                </div>

                <div class="chart-card">
                  <div class="chart-title">Sensitivity snapshot</div>
                  <canvas id="chartSens" height="220" aria-label="Sensitivity chart"></canvas>
                  <div class="chart-note small muted">A quick look at how NPV moves when grain price changes, holding other inputs fixed.</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-head">
              <h2>Comparison to Control</h2>
              <div class="card-head-actions">
                <button class="btn small" type="button" data-action="export-workbook">Export Excel workbook</button>
                <button class="btn small" type="button" data-action="export-sensitivity-csv">Export sensitivity grid CSV</button>
                <button class="btn small" type="button" data-action="export-treatment-summary-csv">Export treatment summary CSV</button>
                <button class="btn small" type="button" data-action="export-cleaned-tsv">Export cleaned dataset TSV</button>
              </div>
            </div>

            <p class="small muted">
              Rows are indicators. Columns are the control baseline and each treatment, with a paired delta column for clarity.
              The control column is pinned and labelled “Control (baseline)”.
            </p>

            <div id="comparisonToControl"></div>
          </div>
        </div>
      </section>

      <!-- DATA IMPORT -->
      <section class="tab-panel" data-tab-panel="import" id="tab-import" role="tabpanel" aria-hidden="true" hidden>
        <div class="page">
          <div class="page-head">
            <h1>Data Import</h1>
            <p class="muted">
              Upload or paste TSV or CSV. If your paste includes a data dictionary section followed by the data section,
              the tool will attempt to split and parse both.
            </p>
          </div>

          <div class="grid two">
            <div class="card">
              <div class="card-head">
                <h2>Upload or paste</h2>
                <div class="card-head-actions">
                  <button class="btn small" id="reloadDefaultFromImport" type="button">Reload default data</button>
                </div>
              </div>

              <p class="small muted">Upload the trial data as a TSV, CSV, or TXT file.</p>
              <div class="field">
                <label for="dataFile">Data file</label>
                <input id="dataFile" type="file" accept=".csv,.tsv,.txt,text/csv,text/tab-separated-values,text/plain" />
              </div>

              <div class="divider"></div>

              <h2>Paste</h2>
              <p class="small muted">Paste TSV or CSV. Quoted fields are supported.</p>
              <div class="field">
                <label for="dataPaste">Paste data</label>
                <textarea id="dataPaste" rows="10" placeholder="Paste TSV or CSV here"></textarea>
              </div>

              <div class="btn-row">
                <button class="btn" id="parseData" type="button">Parse and stage</button>
                <button class="btn primary" id="commitData" type="button">Commit staged dataset</button>
              </div>

              <p class="small muted" id="importSummary">No dataset parsed yet.</p>
            </div>

            <div class="card">
              <h2>Data checks</h2>
              <p class="small muted">
                This panel lists triggered checks and summaries. Error-level checks must be resolved before commit.
              </p>
              <div id="dataChecks"></div>

              <div class="divider"></div>

              <h2>Exports from staged or committed data</h2>
              <p class="small muted">
                These exports use the most recently parsed dataset. If you want exports aligned with results, commit first.
              </p>
              <div class="btn-row">
                <button class="btn" type="button" data-action="export-cleaned-tsv">Cleaned dataset TSV</button>
                <button class="btn" type="button" data-action="export-treatment-summary-csv">Treatment summary CSV</button>
                <button class="btn" type="button" data-action="export-workbook">Excel workbook</button>
              </div>
            </div>
          </div>

          <div class="card">
            <h2>Import notes</h2>
            <div class="prose">
              <p>
                The tool infers key columns such as treatment name, replicate, yield, and cost columns. Control is detected using an
                explicit control flag column if available, otherwise by matching treatment labels that contain the word control or baseline.
              </p>
              <p>
                Treatment effects are computed using replicate-specific control baselines, so each plot is compared with the control mean in the same replicate before averaging.
                Missing values and question marks are treated as missing and are excluded from summaries.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- CONFIGURATION -->
      <section class="tab-panel" data-tab-panel="config" id="tab-config" role="tabpanel" aria-hidden="true" hidden>
        <div class="page">
          <div class="page-head">
            <h1>Configuration</h1>
            <p class="muted">Set project metadata, time horizon, discounting, grain price, persistence, adoption and risk, and scenarios.</p>
          </div>

          <div class="grid two">
            <div class="card">
              <h2>Project details</h2>

              <div class="row-2">
                <div class="field">
                  <label for="projectName">Project name</label>
                  <input id="projectName" type="text" />
                </div>
                <div class="field">
                  <label for="organisation">Organisation</label>
                  <input id="organisation" type="text" />
                </div>
              </div>

              <div class="row-2">
                <div class="field">
                  <label for="projectLead">Project lead</label>
                  <input id="projectLead" type="text" />
                </div>
                <div class="field">
                  <label for="analystNames">Analysts</label>
                  <input id="analystNames" type="text" />
                </div>
              </div>

              <div class="row-2">
                <div class="field">
                  <label for="projectTeam">Project team</label>
                  <input id="projectTeam" type="text" />
                </div>
                <div class="field">
                  <label for="lastUpdated">Last updated</label>
                  <input id="lastUpdated" type="date" />
                </div>
              </div>

              <div class="field">
                <label for="projectSummary">Summary</label>
                <textarea id="projectSummary" rows="3"></textarea>
              </div>
              <div class="field">
                <label for="projectObjectives">Objectives</label>
                <textarea id="projectObjectives" rows="3"></textarea>
              </div>
              <div class="field">
                <label for="projectActivities">Activities</label>
                <textarea id="projectActivities" rows="3"></textarea>
              </div>
              <div class="field">
                <label for="stakeholderGroups">Stakeholders</label>
                <textarea id="stakeholderGroups" rows="2"></textarea>
              </div>

              <div class="row-2">
                <div class="field">
                  <label for="contactEmail">Contact email</label>
                  <input id="contactEmail" type="email" />
                </div>
                <div class="field">
                  <label for="contactPhone">Contact phone</label>
                  <input id="contactPhone" type="tel" />
                </div>
              </div>

              <div class="divider"></div>

              <h3>Project framing</h3>
              <div class="field">
                <label for="projectGoal">Goal</label>
                <textarea id="projectGoal" rows="2"></textarea>
              </div>
              <div class="field">
                <label for="withProject">With project</label>
                <textarea id="withProject" rows="2"></textarea>
              </div>
              <div class="field">
                <label for="withoutProject">Without project</label>
                <textarea id="withoutProject" rows="2"></textarea>
              </div>
            </div>

            <div class="card">
              <h2>Base case assumptions</h2>

              <div class="row-3">
                <div class="field">
                  <label for="years">Time horizon (years)</label>
                  <input id="years" type="number" min="0" step="1" />
                </div>
                <div class="field">
                  <label for="discBase">Discount rate (base, percent)</label>
                  <input id="discBase" type="number" step="0.1" />
                </div>
                <div class="field">
                  <label for="grainPrice">Grain price (dollars per tonne)</label>
                  <input id="grainPrice" type="number" step="1" />
                </div>
              </div>

              <div class="row-3">
                <div class="field">
                  <label for="persistenceYears">Persistence (years)</label>
                  <input id="persistenceYears" type="number" min="0" step="1" />
                </div>
                <div class="field">
                  <label for="mirrFinance">MIRR finance rate (percent)</label>
                  <input id="mirrFinance" type="number" step="0.1" />
                </div>
                <div class="field">
                  <label for="mirrReinvest">MIRR reinvest rate (percent)</label>
                  <input id="mirrReinvest" type="number" step="0.1" />
                </div>
              </div>

              <div class="row-2">
                <div class="field">
                  <label for="startYear">Start year</label>
                  <input id="startYear" type="number" step="1" />
                </div>
                <div class="field">
                  <label for="projectStartYear">Project start year</label>
                  <input id="projectStartYear" type="number" step="1" />
                </div>
              </div>

              <div class="divider"></div>

              <h3>Adoption</h3>
              <div class="row-3">
                <div class="field">
                  <label for="adoptBase">Adoption multiplier (base)</label>
                  <input id="adoptBase" type="number" step="0.01" min="0" max="1" />
                </div>
                <div class="field">
                  <label for="adoptLow">Adoption multiplier (low)</label>
                  <input id="adoptLow" type="number" step="0.01" min="0" max="1" />
                </div>
                <div class="field">
                  <label for="adoptHigh">Adoption multiplier (high)</label>
                  <input id="adoptHigh" type="number" step="0.01" min="0" max="1" />
                </div>
              </div>

              <div class="divider"></div>

              <h3>Risk</h3>
              <div class="row-3">
                <div class="field">
                  <label for="riskBase">Risk multiplier (base)</label>
                  <input id="riskBase" type="number" step="0.01" min="0" max="1" />
                </div>
                <div class="field">
                  <label for="riskLow">Risk multiplier (low)</label>
                  <input id="riskLow" type="number" step="0.01" min="0" max="1" />
                </div>
                <div class="field">
                  <label for="riskHigh">Risk multiplier (high)</label>
                  <input id="riskHigh" type="number" step="0.01" min="0" max="1" />
                </div>
              </div>

              <div class="row-5">
                <div class="field">
                  <label for="rTech">Technical</label>
                  <input id="rTech" type="number" step="0.01" min="0" max="1" />
                </div>
                <div class="field">
                  <label for="rNonCoop">Non co operation</label>
                  <input id="rNonCoop" type="number" step="0.01" min="0" max="1" />
                </div>
                <div class="field">
                  <label for="rSocio">Social</label>
                  <input id="rSocio" type="number" step="0.01" min="0" max="1" />
                </div>
                <div class="field">
                  <label for="rFin">Financial</label>
                  <input id="rFin" type="number" step="0.01" min="0" max="1" />
                </div>
                <div class="field">
                  <label for="rMan">Management</label>
                  <input id="rMan" type="number" step="0.01" min="0" max="1" />
                </div>
              </div>

              <div class="btn-row">
                <button class="btn" id="calcCombinedRisk" type="button">Calculate combined risk</button>
                <span class="small muted" id="combinedRiskOut"></span>
              </div>

              <div class="divider"></div>

              <h3>Scenarios</h3>
              <div class="row-3">
                <div class="field">
                  <label for="scenarioName">Scenario name</label>
                  <input id="scenarioName" type="text" placeholder="Type a name, or leave blank for automatic naming" />
                </div>
                <div class="field">
                  <label for="scenarioSelect">Saved scenarios</label>
                  <select id="scenarioSelect">
                    <option value="">Select a saved scenario</option>
                  </select>
                </div>
                <div class="field">
                  <label>&nbsp;</label>
                  <div class="btn-row">
                    <button class="btn" id="saveScenario" type="button">Save</button>
                    <button class="btn" id="loadScenario" type="button">Load</button>
                  </div>
                </div>
              </div>

              <div class="divider"></div>

              <h3>Discount schedule (optional)</h3>
              <p class="small muted">
                If you use these schedule inputs, the app will read and update them. If you do not use these, the base discount rate is used.
              </p>
              <div class="table-wrap">
                <table class="summary-table">
                  <thead>
                    <tr>
                      <th>Period</th>
                      <th>Low (percent)</th>
                      <th>Base (percent)</th>
                      <th>High (percent)</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>2025 to 2034</td>
                      <td><input type="number" step="0.1" data-disc-period="0" data-scenario="low" /></td>
                      <td><input type="number" step="0.1" data-disc-period="0" data-scenario="base" /></td>
                      <td><input type="number" step="0.1" data-disc-period="0" data-scenario="high" /></td>
                    </tr>
                    <tr>
                      <td>2035 to 2044</td>
                      <td><input type="number" step="0.1" data-disc-period="1" data-scenario="low" /></td>
                      <td><input type="number" step="0.1" data-disc-period="1" data-scenario="base" /></td>
                      <td><input type="number" step="0.1" data-disc-period="1" data-scenario="high" /></td>
                    </tr>
                    <tr>
                      <td>2045 to 2054</td>
                      <td><input type="number" step="0.1" data-disc-period="2" data-scenario="low" /></td>
                      <td><input type="number" step="0.1" data-disc-period="2" data-scenario="base" /></td>
                      <td><input type="number" step="0.1" data-disc-period="2" data-scenario="high" /></td>
                    </tr>
                    <tr>
                      <td>2055 to 2064</td>
                      <td><input type="number" step="0.1" data-disc-period="3" data-scenario="low" /></td>
                      <td><input type="number" step="0.1" data-disc-period="3" data-scenario="base" /></td>
                      <td><input type="number" step="0.1" data-disc-period="3" data-scenario="high" /></td>
                    </tr>
                    <tr>
                      <td>2065 to 2074</td>
                      <td><input type="number" step="0.1" data-disc-period="4" data-scenario="low" /></td>
                      <td><input type="number" step="0.1" data-disc-period="4" data-scenario="base" /></td>
                      <td><input type="number" step="0.1" data-disc-period="4" data-scenario="high" /></td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="divider"></div>

              <h3>Jump to Results</h3>
              <div class="btn-row">
                <button class="btn primary" type="button" data-tab-jump="results">Recompute and view Results</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- OUTPUTS -->
      <section class="tab-panel" data-tab-panel="outputs" id="tab-outputs" role="tabpanel" aria-hidden="true" hidden>
        <div class="page">
          <div class="page-head">
            <h1>Outputs</h1>
            <p class="muted">
              Outputs define the economic value mapping. The tool expects “Grain yield” with unit t per hectare and uses its value as grain price when no separate price input is set.
            </p>
          </div>

          <div class="card">
            <div class="card-head">
              <h2>Outputs list</h2>
              <div class="card-head-actions">
                <span class="small muted">Outputs are editable. Treatments will show a delta input per output.</span>
              </div>
            </div>

            <div id="outputsList"></div>
          </div>
        </div>
      </section>

      <!-- TREATMENTS -->
      <section class="tab-panel" data-tab-panel="treatments" id="tab-treatments" role="tabpanel" aria-hidden="true" hidden>
        <div class="page">
          <div class="page-head">
            <h1>Treatments</h1>
            <p class="muted">
              Each treatment stores incremental costs per hectare per application and output deltas per hectare. Recurrence controls how often incremental costs repeat across the horizon.
            </p>
          </div>

          <div class="card">
            <div class="card-head">
              <h2>Treatments list</h2>
              <div class="card-head-actions">
                <span class="small muted">Import calibrates deltas and incremental costs from plot data. You can edit values here.</span>
              </div>
            </div>

            <div id="treatmentsList"></div>
          </div>
        </div>
      </section>

      <!-- SENSITIVITY -->
      <section class="tab-panel" data-tab-panel="sensitivity" id="tab-sensitivity" role="tabpanel" aria-hidden="true" hidden>
        <div class="page">
          <div class="page-head">
            <h1>Sensitivity</h1>
            <p class="muted">
              Runs a grid across grain price, discount rate, persistence of yield effects, and recurrence of costs. Export the grid to analyse in Excel.
            </p>
          </div>

          <div class="card">
            <div class="card-head">
              <h2>Run sensitivity grid</h2>
              <div class="card-head-actions">
                <button class="btn primary" type="button" data-action="run-sensitivity">Run sensitivity</button>
                <button class="btn" type="button" data-action="export-sensitivity-csv">Export grid CSV</button>
                <button class="btn" type="button" data-action="export-workbook">Export Excel workbook</button>
              </div>
            </div>

            <p class="small muted">
              The grid size can be large. Export is the recommended way to inspect results in detail.
            </p>

            <div id="sensitivitySummary" class="prose"></div>
          </div>

          <div class="card">
            <h2>Sensitivity figure</h2>
            <p class="small muted">A quick visual summary (base case values plus the most important movements).</p>
            <div class="chart-card">
              <div class="chart-title">NPV across grain price for top NPV treatment</div>
              <canvas id="chartSensTab" height="260" aria-label="Sensitivity chart tab"></canvas>
              <div class="chart-note small muted">This helps show how strongly results lean on grain price assumptions.</div>
            </div>
          </div>
        </div>
      </section>

      <!-- AI BRIEFING -->
      <section class="tab-panel" data-tab-panel="ai" id="tab-ai" role="tabpanel" aria-hidden="true" hidden>
        <div class="page">
          <div class="page-head">
            <h1>AI Briefing</h1>
            <p class="muted">
              Generates a copy-ready prompt that uses computed results only. The briefing uses full sentences and paragraphs only, with no bullet points, no em dash, and no abbreviations.
            </p>
          </div>

          <div class="grid two">
            <div class="card">
              <div class="card-head">
                <h2>Briefing text</h2>
                <div class="card-head-actions">
                  <button class="btn" type="button" data-action="copy-ai-briefing">Copy briefing text</button>
                </div>
              </div>

              <div class="field">
                <label for="aiBriefingText">Briefing prompt</label>
                <textarea id="aiBriefingText" rows="16"></textarea>
              </div>
            </div>

            <div class="card">
              <div class="card-head">
                <h2>Results JSON</h2>
                <div class="card-head-actions">
                  <button class="btn" type="button" data-action="copy-results-json">Copy results JSON</button>
                </div>
              </div>

              <div class="field">
                <label for="resultsJson">Results payload</label>
                <textarea id="resultsJson" rows="16"></textarea>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- INTRODUCTION -->
      <section class="tab-panel" data-tab-panel="intro" id="tab-intro" role="tabpanel" aria-hidden="true" hidden>
        <div class="page">
          <div class="page-head">
            <h1>Introduction</h1>
            <p class="muted">A quick guide to what the tool does and how to use it with your trial dataset.</p>
          </div>

          <div class="card">
            <h2>How to use this tool</h2>
            <div class="prose">
              <p>
                This tool compares each treatment against a control baseline using discounted cashflows. Benefits come from yield differences valued at grain price.
                Costs come from incremental per hectare application costs that can repeat according to the recurrence setting, plus any year zero capital cost.
              </p>
              <p>
                The tool loads a default trial dataset automatically when the default file exists in the same folder. You can still upload or paste your own dataset in the Data Import tab.
                After import, review the Data Checks panel. If there are error level checks, fix the dataset and parse again. When checks look acceptable, commit the staged dataset.
              </p>
              <p>
                Then review Configuration. Set grain price, discount rate, persistence, adoption, and risk multipliers. Results update when inputs change.
                Use Sensitivity to explore how results change under different prices, discount rates, persistence assumptions, and recurrence frequencies.
              </p>
            </div>
          </div>

          <div class="card">
            <h2>Definitions</h2>
            <div class="prose">
              <p>
                Net present value is the present value of benefits minus the present value of costs. Present value of benefits is the discounted value of yield revenue gains compared with the control.
                Present value of costs is the discounted value of incremental costs, including any year zero capital cost. Benefit cost ratio is present value of benefits divided by present value of costs.
                Return on investment is net present value divided by present value of costs, expressed as a percentage.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- TECHNICAL APPENDIX (panel kept as a link + status, but the tab opens a new page) -->
      <section class="tab-panel" data-tab-panel="appendix" id="tab-appendix" role="tabpanel" aria-hidden="true" hidden>
        <div class="page">
          <div class="page-head">
            <h1>Technical Appendix</h1>
            <p class="muted">Opens in a new tab. If popups are blocked, use the link below.</p>
          </div>

          <div class="card">
            <h2>Open the Technical Appendix</h2>
            <div class="prose">
              <p>
                <a href="technical-appendix.html" target="_blank" rel="noopener">Open technical-appendix.html in a new tab</a>.
              </p>
              <p>
                The appendix page explains schema inference, replicate-specific baselines, cost scaling, and the exact export fields.
              </p>
            </div>
          </div>

          <div class="card">
            <h2>Import summary</h2>
            <p class="small muted" id="importStatus">No dataset parsed yet.</p>
          </div>
        </div>
      </section>
    </main>

    <footer class="app-footer">
      <div class="small muted">
        Built for farming decision support. This tool explains trade-offs and sensitivity. It does not prescribe choices.
      </div>
    </footer>
  </div>
</body>
</html>
