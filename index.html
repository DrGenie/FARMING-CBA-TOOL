<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Farming CBA Decision Tool 2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="app">
  <header class="app-header">
    <div class="app-header-main">
      <div class="app-title-block">
        <div class="app-logo-circle">F</div>
        <div>
          <h1>Farming CBA Decision Tool 2</h1>
          <p>Decision support for farm cost–benefit analysis, using your own Excel data.</p>
        </div>
      </div>
      <div class="app-header-actions">
        <button id="btn-load-sample" type="button" class="btn btn-ghost">Load small sample</button>
        <button id="btn-print" type="button" class="btn btn-ghost">Print / Export to PDF</button>
      </div>
    </div>
    <div class="app-header-sub">
      <p>
        Use Excel to hold all detailed calculations. This tool focuses on clear comparison of treatments against a
        control, headline economic indicators, and AI-ready prompts for farmer-friendly interpretation.
      </p>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab-button active" data-tab="treatments">1. Treatments & costs</button>
    <button class="tab-button" data-tab="results">2. Results matrix</button>
    <button class="tab-button" data-tab="snapshots">3. Snapshots</button>
    <button class="tab-button" data-tab="excel">4. Excel & templates</button>
    <button class="tab-button" data-tab="ai">5. AI helper</button>
  </nav>

  <main class="app-main">

    <!-- Treatments & costs -->
    <section id="tab-treatments" class="tab-panel active">
      <div class="card">
        <div class="card-header">
          <h2>Treatments, areas and cost components</h2>
          <p>
            Each row is a treatment or strategy (for example a soil amendment package, fertiliser program, or control).
            Costs are broken into a one-off capital cost at year 0 and recurring annual costs per hectare. Benefits are
            driven by yield, price and any other annual benefits per hectare.
          </p>
        </div>

        <div class="card-toolbar">
          <div class="toolbar-left">
            <button id="btn-add-treatment" type="button" class="btn btn-primary">Add treatment</button>
            <button id="btn-update-results" type="button" class="btn btn-secondary">Update results</button>
          </div>
          <div class="toolbar-right">
            <button id="btn-clear-all" type="button" class="btn btn-danger-outline">Clear all</button>
          </div>
        </div>

        <div class="table-wrapper">
          <table class="table" id="treatments-table">
            <thead>
            <tr>
              <th>Treatment name<br><span class="th-sub">Include “Control” in name for baseline</span></th>
              <th>Is control?</th>
              <th>Area (ha)</th>
              <th>
                Capital cost<br>($, year 0)
                <span class="indicator-tooltip" data-tooltip="One-off capital spending at the start of the project, for this treatment.">?</span>
              </th>
              <th>
                Annual cost<br>($/ha/year)
                <span class="indicator-tooltip" data-tooltip="Average annual variable or operating cost per hectare for this treatment.">?</span>
              </th>
              <th>
                Yield<br>(t/ha/year)
                <span class="indicator-tooltip" data-tooltip="Average annual grain or product yield per hectare for this treatment.">?</span>
              </th>
              <th>
                Price<br>($/t)
                <span class="indicator-tooltip" data-tooltip="Expected average price received per tonne of output.">?</span>
              </th>
              <th>
                Other annual benefits<br>($/ha/year)
                <span class="indicator-tooltip" data-tooltip="Any additional annual benefits per hectare (for example risk reduction or co-products), expressed in money terms.">?</span>
              </th>
              <th>Notes / description</th>
              <th></th>
            </tr>
            </thead>
            <tbody id="treatments-tbody">
            <!-- populated by script.js -->
            </tbody>
          </table>
        </div>

        <div class="card-footer">
          <p>
            Capital cost is shown before annual cost. All key indicators (PV benefits, PV costs, NPV, BCR, ROI) are
            recalculated dynamically when you change these values and click “Update results”.
          </p>
        </div>
      </div>

      <div class="card card-narrow-top">
        <div class="card-header">
          <h2>Global assumptions</h2>
          <p>
            These assumptions are used for the present value calculations and for the AI interpretation prompt.
          </p>
        </div>
        <div class="assumptions-grid">
          <div class="assumption-field">
            <label>Discount rate (% per year)
              <input type="number" id="discount-rate" value="7" step="0.1">
            </label>
          </div>
          <div class="assumption-field">
            <label>Analysis horizon (years)
              <input type="number" id="analysis-years" value="10" step="1">
            </label>
          </div>
          <div class="assumption-field">
            <label>Currency label
              <input type="text" id="currency-label" value="$">
            </label>
          </div>
        </div>
      </div>
    </section>

    <!-- Results matrix -->
    <section id="tab-results" class="tab-panel">
      <div class="card">
        <div class="card-header">
          <h2>Results matrix: comparison against control</h2>
          <p>
            Indicators are shown as rows and treatments as columns. The control appears alongside all treatments, with
            figures aligned vertically for easy comparison. Low-performing treatments are shown, not hidden.
          </p>
        </div>

        <div class="results-toolbar">
          <div class="results-toolbar-left">
            <label class="scenario-label">
              Scenario:
              <select id="scenario-select">
                <option value="base">Base case (as entered)</option>
                <option value="lowPrice">Lower commodity prices (−20% price)</option>
                <option value="highCost">Higher costs (+20% annual costs)</option>
                <option value="optimistic">Optimistic (+20% price, −10% annual costs)</option>
              </select>
            </label>
          </div>
          <div id="results-summary" class="results-summary"></div>
        </div>

        <div class="table-wrapper horizontal-scroll">
          <table class="table table-compact" id="results-matrix-table">
            <thead id="results-matrix-head">
            <!-- populated by script.js -->
            </thead>
            <tbody id="results-matrix-body">
            <!-- populated by script.js -->
            </tbody>
          </table>
        </div>

        <div class="card-footer card-footer-grid">
          <div>
            <h3>Key economic indicators</h3>
            <p>
              <strong>Net present value (NPV)</strong>
              <span class="indicator-tooltip" data-tooltip="NPV = PV benefits − PV costs. NPV above zero indicates a net economic gain in present value terms.">?</span>
              is the core economic measure. It combines all benefits and costs over time using the chosen discount rate.
            </p>
            <p>
              <strong>Benefit–cost ratio (BCR)</strong>
              <span class="indicator-tooltip" data-tooltip="BCR = PV benefits ÷ PV costs. Values above 1 mean benefits exceed costs in present value terms.">?</span>
              and <strong>return on investment (ROI)</strong>
              <span class="indicator-tooltip" data-tooltip="ROI = NPV ÷ PV costs. This can be read as net gain per dollar of PV cost.">?</span>
              help show how hard each dollar of cost is working. Rankings are based on NPV under the selected scenario.
            </p>
          </div>
          <div class="note-box">
            <strong>Control comparison</strong>
            <p>
              The control (usually current practice) is highlighted. The “Δ NPV vs control” row shows how much extra value
              each treatment is expected to create in present value terms relative to the control, under the chosen scenario.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Snapshots -->
    <section id="tab-snapshots" class="tab-panel">
      <div class="card">
        <div class="card-header">
          <h2>Snapshots by treatment</h2>
          <p>
            Headline numbers only: PV benefits, PV costs, NPV, BCR and ROI for each treatment. Detailed narratives are
            optional and handled via AI on the next tab.
          </p>
          <p id="snapshots-scenario-label" class="scenario-label-text"></p>
        </div>

        <div id="snapshots-container" class="snapshots-grid">
          <!-- populated by script.js -->
        </div>
      </div>
    </section>

    <!-- Excel & templates -->
    <section id="tab-excel" class="tab-panel">
      <div class="card">
        <div class="card-header">
          <h2>Excel-first workflow</h2>
          <p>
            The core design is Excel-first. Keep all detailed yield and cost calculations in Excel, then use
            <strong>Farming CBA Decision Tool 2</strong> as a clean results and interpretation front-end.
          </p>
        </div>

        <div class="excel-layout">
          <div class="excel-step">
            <h3>1. Download template</h3>
            <p>
              Download a clean template, or a template pre-filled with your current treatments. Work in Excel to paste in
              your full Faba Beans dataset or other crops. One row in the template corresponds to one treatment or plot.
            </p>
            <button id="btn-download-template" type="button" class="btn btn-primary">Download blank Excel template (CSV)</button>
            <button id="btn-download-current" type="button" class="btn btn-secondary">Download current data as template (CSV)</button>
          </div>

          <div class="excel-step">
            <h3>2. Edit and save in Excel</h3>
            <p>
              In Excel, fill or adjust the following columns (header names must stay the same):
            </p>
            <p class="excel-tip">
              <code>TreatmentName, IsControl, AreaHa, Yield_t_per_ha, Price_per_tonne, CapitalCost_year0, AnnualCost_per_ha, OtherAnnualBenefits_per_ha, Notes</code>
            </p>
            <p>
              You can paste your entire Faba Beans dataset, with no treatments omitted, by mapping each plot or treatment
              combination into one row in this template.
            </p>
          </div>

          <div class="excel-step">
            <h3>3. Upload and recalculate</h3>
            <p>
              Save your template as CSV in Excel, then upload it here. The tool validates the header, parses each row,
              and automatically recalculates all indicators and rankings for you.
            </p>
            <input type="file" id="file-import-csv" accept=".csv" class="file-input">
            <p class="excel-tip">
              After upload, all tabs (results matrix, snapshots, AI helper) update based on your actual Excel data.
            </p>
            <h3 style="margin-top:12px;">4. Export results back to Excel</h3>
            <p>
              Export the ranked results matrix as a CSV file suitable for Excel, policy briefs, or reports.
            </p>
            <button id="btn-export-results-csv" type="button" class="btn btn-primary">Download results matrix (CSV)</button>
          </div>
        </div>
      </div>
    </section>

    <!-- AI helper -->
    <section id="tab-ai" class="tab-panel">
      <div class="card">
        <div class="card-header">
          <h2>AI interpretation helper</h2>
          <p>
            This tool builds a structured prompt for use with Copilot, ChatGPT, or any other large language model. The AI
            model will generate a plain-English interpretation and optional policy brief using your own results.
          </p>
        </div>

        <div class="helper-body">
          <div class="helper-controls">
            <button id="btn-refresh-ai-prompt" type="button" class="btn btn-secondary">Refresh AI prompt</button>
            <button id="btn-download-ai-prompt" type="button" class="btn btn-primary">Download AI prompt (.txt)</button>
          </div>
          <p class="helper-instruction">
            Step 1: Click “Refresh AI prompt”.<br>
            Step 2: Copy the full text below and paste it into your preferred AI assistant.<br>
            Step 3: Ask the AI to generate a 2–3 page interpretation and, if needed, a longer policy brief.
          </p>
          <textarea id="ai-prompt-text" class="helper-textarea" rows="22" readonly></textarea>
        </div>
      </div>
    </section>

  </main>

  <footer class="app-footer">
    <p>
      Farming CBA Decision Tool 2 · Decision support only. Results depend on the quality of your Excel inputs and assumptions.
    </p>
  </footer>
</div>

<script src="script.js"></script>
</body>
</html>
