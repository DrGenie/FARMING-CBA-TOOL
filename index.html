<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Farming CBA Decision Aid - Newcastle Business School</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body data-theme="worldbank-light">
  <div id="toast-root"></div>

  <header class="app-header">
    <div class="brand">
      <div class="brand-mark">NBS</div>
      <div class="brand-text">
        <div class="brand-title">Farming CBA Decision Aid</div>
        <div class="brand-subtitle">Newcastle Business School</div>
      </div>
    </div>
    <div class="header-actions">
      <button id="startBtn" class="btn primary">Start with project setup</button>
      <button id="saveProject" class="btn ghost">Save project (JSON)</button>
      <button id="loadProject" class="btn ghost">Load project</button>
      <input type="file" id="loadFile" accept=".json" style="display:none" />
    </div>
  </header>

  <main class="app-main">
    <nav class="tabs-nav" aria-label="Main sections">
      <button type="button" class="tab-link active" data-tab="intro" aria-selected="true">Introduction</button>
      <button type="button" class="tab-link" data-tab="project">Project</button>
      <button type="button" class="tab-link" data-tab="settings">Time and risk settings</button>
      <button type="button" class="tab-link" data-tab="outputs">Outputs</button>
      <button type="button" class="tab-link" data-tab="treatments">Treatments</button>
      <button type="button" class="tab-link" data-tab="benefits">Additional benefits</button>
      <button type="button" class="tab-link" data-tab="costs">Other costs</button>
      <button type="button" class="tab-link" data-tab="database">Sources</button>
      <button type="button" class="tab-link" data-tab="results">Results</button>
      <button type="button" class="tab-link" data-tab="simulation">Simulation</button>
      <button type="button" class="tab-link" data-tab="excel">Excel import and export</button>
      <button type="button" class="tab-link" data-tab="copilot">Policy brief helper</button>
    </nav>

<!-- INTRO TAB -->
<section class="tab-panel active show" id="tab-intro" data-tab-panel="intro" aria-hidden="false">
  <div class="card">
    <h1>Farming cost benefit analysis tool</h1>
    <p>
      This tool summarises the costs and benefits of farm treatments over a chosen analysis
      period. It is designed for applied farm trials and for rapid assessment of alternative
      strategies.
    </p>
    <p>
      Use the tabs to move from project description, through outputs and treatments, to
      additional benefits, costs, and risk settings. The Results and Simulation tabs provide
      economic indicators and uncertainty analysis.
    </p>
    <div class="intro-actions">
      <button id="startBtn-duplicate" class="btn primary" data-tab-jump="project">
        Go to project setup
      </button>
      <button class="btn" data-tab-jump="outputs">Jump to outputs</button>
      <button class="btn" data-tab-jump="results">Jump to results</button>
    </div>
  </div>
</section>

<!-- PROJECT TAB -->
<section class="tab-panel" id="tab-project" data-tab-panel="project" aria-hidden="true">
  <div class="card">
    <h2>Project description</h2>
    <div class="row-3">
      <div class="field">
        <label for="projectName">Project name</label>
        <input id="projectName" type="text" />
      </div>
      <div class="field">
        <label for="projectLead">Project lead</label>
        <input id="projectLead" type="text" />
      </div>
      <div class="field">
        <label for="analystNames">Analyst team</label>
        <input id="analystNames" type="text" />
      </div>
    </div>

    <div class="row-3">
      <div class="field">
        <label for="projectTeam">Partners or trial team</label>
        <input id="projectTeam" type="text" />
      </div>
      <div class="field">
        <label for="organisation">Organisation</label>
        <input id="organisation" type="text" />
      </div>
      <div class="field">
        <label for="lastUpdated">Last updated</label>
        <input id="lastUpdated" type="date" />
      </div>
    </div>

    <div class="row-3">
      <div class="field">
        <label for="contactEmail">Contact email</label>
        <input id="contactEmail" type="email" />
      </div>
      <div class="field">
        <label for="contactPhone">Contact phone</label>
        <input id="contactPhone" type="tel" />
      </div>
      <div class="field"></div>
    </div>

    <div class="field">
      <label for="projectSummary">Short summary</label>
      <textarea id="projectSummary" rows="3"></textarea>
    </div>

    <div class="field">
      <label for="projectGoal">Project goal</label>
      <textarea id="projectGoal" rows="2"></textarea>
    </div>

    <div class="row-2">
      <div class="field">
        <label for="withProject">With project (change story)</label>
        <textarea id="withProject" rows="3"></textarea>
      </div>
      <div class="field">
        <label for="withoutProject">Without project (baseline story)</label>
        <textarea id="withoutProject" rows="3"></textarea>
      </div>
    </div>

    <div class="field">
      <label for="projectObjectives">Key objectives</label>
      <textarea id="projectObjectives" rows="3"></textarea>
    </div>

    <div class="field">
      <label for="projectActivities">Main activities</label>
      <textarea id="projectActivities" rows="3"></textarea>
    </div>

    <div class="field">
      <label for="stakeholderGroups">Stakeholder groups</label>
      <textarea id="stakeholderGroups" rows="3"></textarea>
    </div>
  </div>
</section>

<!-- SETTINGS TAB -->
<section class="tab-panel" id="tab-settings" data-tab-panel="settings" aria-hidden="true">
  <div class="card">
    <h2>Time horizon and discounting</h2>
    <div class="row-4">
      <div class="field">
        <label for="startYear">Analysis start year</label>
        <input id="startYear" type="number" />
      </div>
      <div class="field">
        <label for="projectStartYear">Project start year</label>
        <input id="projectStartYear" type="number" />
      </div>
      <div class="field">
        <label for="years">Years of analysis</label>
        <input id="years" type="number" min="1" />
      </div>
      <div class="field">
        <label for="systemType">System type</label>
        <select id="systemType">
          <option value="single">Single farm or system</option>
          <option value="multiple">Multiple farms or systems</option>
        </select>
      </div>
    </div>

    <div class="row-4">
      <div class="field">
        <label for="discBase">Discount rate (base, percent)</label>
        <input id="discBase" type="number" step="0.1" />
      </div>
      <div class="field">
        <label for="discLow">Discount rate (low, percent)</label>
        <input id="discLow" type="number" step="0.1" />
      </div>
      <div class="field">
        <label for="discHigh">Discount rate (high, percent)</label>
        <input id="discHigh" type="number" step="0.1" />
      </div>
      <div class="field">
        <label for="outputAssumptions">Notes on general assumptions</label>
        <textarea id="outputAssumptions" rows="2"></textarea>
      </div>
    </div>

    <div class="row-4">
      <div class="field">
        <label for="mirrFinance">MIRR finance rate (percent)</label>
        <input id="mirrFinance" type="number" step="0.1" />
      </div>
      <div class="field">
        <label for="mirrReinvest">MIRR reinvestment rate (percent)</label>
        <input id="mirrReinvest" type="number" step="0.1" />
      </div>
      <div class="field"></div>
      <div class="field"></div>
    </div>

    <h3>Discount schedule by period</h3>
    <p class="small muted">
      Adjust the low, base, and high discount rates used in the simulation for each period.
    </p>
    <div class="table-scroll">
      <table class="summary-table">
        <thead>
          <tr>
            <th>Period</th>
            <th>Low (percent)</th>
            <th>Base (percent)</th>
            <th>High (percent)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>2025 to 2034</td>
            <td><input type="number" step="0.1" data-disc-period="0" data-scenario="low" /></td>
            <td><input type="number" step="0.1" data-disc-period="0" data-scenario="base" /></td>
            <td><input type="number" step="0.1" data-disc-period="0" data-scenario="high" /></td>
          </tr>
          <tr>
            <td>2035 to 2044</td>
            <td><input type="number" step="0.1" data-disc-period="1" data-scenario="low" /></td>
            <td><input type="number" step="0.1" data-disc-period="1" data-scenario="base" /></td>
            <td><input type="number" step="0.1" data-disc-period="1" data-scenario="high" /></td>
          </tr>
          <tr>
            <td>2045 to 2054</td>
            <td><input type="number" step="0.1" data-disc-period="2" data-scenario="low" /></td>
            <td><input type="number" step="0.1" data-disc-period="2" data-scenario="base" /></td>
            <td><input type="number" step="0.1" data-disc-period="2" data-scenario="high" /></td>
          </tr>
          <tr>
            <td>2055 to 2064</td>
            <td><input type="number" step="0.1" data-disc-period="3" data-scenario="low" /></td>
            <td><input type="number" step="0.1" data-disc-period="3" data-scenario="base" /></td>
            <td><input type="number" step="0.1" data-disc-period="3" data-scenario="high" /></td>
          </tr>
          <tr>
            <td>2065 to 2074</td>
            <td><input type="number" step="0.1" data-disc-period="4" data-scenario="low" /></td>
            <td><input type="number" step="0.1" data-disc-period="4" data-scenario="base" /></td>
            <td><input type="number" step="0.1" data-disc-period="4" data-scenario="high" /></td>
          </tr>
        </tbody>
      </table>
    </div>

    <h3>Adoption settings</h3>
    <p class="small muted">
      These parameters control the adoption paths used in the results and simulation. Adoption
      by treatment is not entered in the treatment tab. It is handled here as a scenario setting.
    </p>
    <div class="row-3">
      <div class="field">
        <label for="adoptLow">Adoption low (multiplier)</label>
        <input id="adoptLow" type="number" step="0.05" min="0" max="1" />
      </div>
      <div class="field">
        <label for="adoptBase">Adoption base (multiplier)</label>
        <input id="adoptBase" type="number" step="0.05" min="0" max="1" />
      </div>
      <div class="field">
        <label for="adoptHigh">Adoption high (multiplier)</label>
        <input id="adoptHigh" type="number" step="0.05" min="0" max="1" />
      </div>
    </div>

    <h3>Risk settings</h3>
    <div class="row-3">
      <div class="field">
        <label for="riskLow">Overall risk low</label>
        <input id="riskLow" type="number" step="0.01" min="0" max="1" />
      </div>
      <div class="field">
        <label for="riskBase">Overall risk base</label>
        <input id="riskBase" type="number" step="0.01" min="0" max="1" />
      </div>
      <div class="field">
        <label for="riskHigh">Overall risk high</label>
        <input id="riskHigh" type="number" step="0.01" min="0" max="1" />
      </div>
    </div>

    <p class="small muted">
      You can also build the base risk from component risks below.
    </p>
    <div class="row-5">
      <div class="field">
        <label for="rTech">Technical risk</label>
        <input id="rTech" type="number" step="0.01" min="0" max="1" />
      </div>
      <div class="field">
        <label for="rNonCoop">Non cooperation risk</label>
        <input id="rNonCoop" type="number" step="0.01" min="0" max="1" />
      </div>
      <div class="field">
        <label for="rSocio">Social risk</label>
        <input id="rSocio" type="number" step="0.01" min="0" max="1" />
      </div>
      <div class="field">
        <label for="rFin">Financial risk</label>
        <input id="rFin" type="number" step="0.01" min="0" max="1" />
      </div>
      <div class="field">
        <label for="rMan">Management risk</label>
        <input id="rMan" type="number" step="0.01" min="0" max="1" />
      </div>
    </div>
    <div class="row-2">
      <div class="field">
        <button id="calcCombinedRisk" class="btn">
          Calculate combined base risk
        </button>
      </div>
      <div class="field">
        <div id="combinedRiskOut" class="metric">
          <div class="label">Combined risk</div>
          <div class="value small muted">Not calculated yet</div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- OUTPUTS TAB -->
<section class="tab-panel" id="tab-outputs" data-tab-panel="outputs" aria-hidden="true">
  <div class="card">
    <h2>Outputs and valuation</h2>
    <p>
      Outputs describe the main production changes per hectare or per unit. Assign a monetary
      value per unit to link them to benefits.
    </p>
    <div class="toolbar">
      <button id="addOutput" class="btn small">Add output</button>
    </div>
    <div id="outputsList" class="item-list"></div>
  </div>
</section>

<!-- TREATMENTS TAB -->
<section class="tab-panel" id="tab-treatments" data-tab-panel="treatments" aria-hidden="true">
  <div class="card">
    <h2>Treatments and control</h2>
    <p>
      Each treatment represents a defined practice or combination of practices applied to a
      given area. Select one treatment as the control by using the "Control vs treatment" field.
    </p>
    <div class="toolbar">
      <button id="addTreatment" class="btn small">Add treatment</button>
    </div>
    <div id="treatmentsList" class="item-list"></div>
  </div>
</section>

<!-- BENEFITS TAB -->
<section class="tab-panel" id="tab-benefits" data-tab-panel="benefits" aria-hidden="true">
  <div class="card">
    <h2>Additional benefits</h2>
    <p>
      Use this section for cost savings, avoided losses, risk reduction, and asset value
      changes that are not already captured in the treatment outputs.
    </p>
    <div class="toolbar">
      <button id="addBenefit" class="btn small">Add benefit</button>
    </div>
    <div id="benefitsList" class="item-list"></div>
  </div>
</section>

<!-- COSTS TAB -->
<section class="tab-panel" id="tab-costs" data-tab-panel="costs" aria-hidden="true">
  <div class="card">
    <h2>Other project costs</h2>
    <p>
      Enter project management, monitoring, extension, or other aggregated costs here. Capital
      items can include depreciation information. Depreciation settings only apply to items in
      the capital category.
    </p>
    <div class="toolbar">
      <button id="addCost" class="btn small">Add cost item</button>
    </div>
    <div id="costsList" class="item-list"></div>
  </div>
</section>

<!-- DATABASE TAB -->
<section class="tab-panel" id="tab-database" data-tab-panel="database" aria-hidden="true">
  <div class="card">
    <h2>Sources and database tagging</h2>
    <p class="small muted">
      Use this tab to record data sources that can later be linked to a shared database or
      evidence register.
    </p>

    <h3>Outputs</h3>
    <div id="dbOutputs" class="item-list"></div>

    <h3>Treatments</h3>
    <div id="dbTreatments" class="item-list"></div>
  </div>
</section>

<!-- RESULTS TAB -->
<section class="tab-panel" id="tab-results" data-tab-panel="results" aria-hidden="true">
  <div class="card">
    <div class="results-header">
      <h2>Economic results</h2>
      <button id="recalc" class="btn primary" data-action="recalc">
        Recalculate results
      </button>
    </div>

    <h3>Whole project summary (base case)</h3>
    <div class="row-4 metrics-grid">
      <div class="field">
        <label>Present value of benefits</label>
        <div class="metric">
          <div id="pvBenefits" class="value">0</div>
          <div class="label">All benefits, discounted</div>
        </div>
      </div>
      <div class="field">
        <label>Present value of costs</label>
        <div class="metric">
          <div id="pvCosts" class="value">0</div>
          <div class="label">All costs, discounted</div>
        </div>
      </div>
      <div class="field">
        <label>Net present value</label>
        <div class="metric">
          <div id="npv" class="value">0</div>
          <div class="label">Benefits minus costs</div>
        </div>
      </div>
      <div class="field">
        <label>Benefit cost ratio</label>
        <div class="metric">
          <div id="bcr" class="value">0</div>
          <div class="label">PV benefits divided by PV costs</div>
        </div>
      </div>
    </div>

    <div class="row-4 metrics-grid">
      <div class="field">
        <label>Internal rate of return</label>
        <div class="metric">
          <div id="irr" class="value">0</div>
          <div class="label">Percent return solving NPV equal to zero</div>
        </div>
      </div>
      <div class="field">
        <label>Modified internal rate of return</label>
        <div class="metric">
          <div id="mirr" class="value">0</div>
          <div class="label">Uses finance and reinvestment rates</div>
        </div>
      </div>
      <div class="field">
        <label>Return on investment</label>
        <div class="metric">
          <div id="roi" class="value">0</div>
          <div class="label">NPV relative to PV of costs</div>
        </div>
      </div>
      <div class="field">
        <label>Payback period</label>
        <div class="metric">
          <div id="payback" class="value">0</div>
          <div class="label">Discounted time to recover costs</div>
        </div>
      </div>
    </div>

    <div class="row-2 metrics-grid">
      <div class="field">
        <label>Annual gross margin</label>
        <div class="metric">
          <div id="grossMargin" class="value">0</div>
          <div class="label">Average annual benefits minus costs</div>
        </div>
      </div>
      <div class="field">
        <label>Gross profit margin</label>
        <div class="metric">
          <div id="profitMargin" class="value">0</div>
          <div class="label">Gross margin as a share of benefits</div>
        </div>
      </div>
    </div>

    <hr />

    <h3>Control and treatment group comparison</h3>
    <p class="small muted">
      Control metrics are only shown if one treatment is flagged as control in the treatments
      tab.
    </p>
    <div class="row-2">
      <div class="card subtle">
        <h4>Control</h4>
        <div class="row-3 metrics-grid">
          <div class="field">
            <label>PV benefits</label>
            <div class="metric"><div id="pvBenefitsControl" class="value">n/a</div></div>
          </div>
          <div class="field">
            <label>PV costs</label>
            <div class="metric"><div id="pvCostsControl" class="value">n/a</div></div>
          </div>
          <div class="field">
            <label>NPV</label>
            <div class="metric"><div id="npvControl" class="value">n/a</div></div>
          </div>
        </div>
        <div class="row-3 metrics-grid">
          <div class="field">
            <label>BCR</label>
            <div class="metric"><div id="bcrControl" class="value">n/a</div></div>
          </div>
          <div class="field">
            <label>IRR</label>
            <div class="metric"><div id="irrControl" class="value">n/a</div></div>
          </div>
          <div class="field">
            <label>ROI</label>
            <div class="metric"><div id="roiControl" class="value">n/a</div></div>
          </div>
        </div>
        <div class="row-2 metrics-grid">
          <div class="field">
            <label>Payback</label>
            <div class="metric"><div id="paybackControl" class="value">n/a</div></div>
          </div>
          <div class="field">
            <label>Annual gross margin</label>
            <div class="metric"><div id="gmControl" class="value">n/a</div></div>
          </div>
        </div>
      </div>

      <div class="card subtle">
        <h4>Combined treatment group</h4>
        <div class="row-3 metrics-grid">
          <div class="field">
            <label>PV benefits</label>
            <div class="metric"><div id="pvBenefitsTreat" class="value">n/a</div></div>
          </div>
          <div class="field">
            <label>PV costs</label>
            <div class="metric"><div id="pvCostsTreat" class="value">n/a</div></div>
          </div>
          <div class="field">
            <label>NPV</label>
            <div class="metric"><div id="npvTreat" class="value">n/a</div></div>
          </div>
        </div>
        <div class="row-3 metrics-grid">
          <div class="field">
            <label>BCR</label>
            <div class="metric"><div id="bcrTreat" class="value">n/a</div></div>
          </div>
          <div class="field">
            <label>IRR</label>
            <div class="metric"><div id="irrTreat" class="value">n/a</div></div>
          </div>
          <div class="field">
            <label>ROI</label>
            <div class="metric"><div id="roiTreat" class="value">n/a</div></div>
          </div>
        </div>
        <div class="row-2 metrics-grid">
          <div class="field">
            <label>Payback</label>
            <div class="metric"><div id="paybackTreat" class="value">n/a</div></div>
          </div>
          <div class="field">
            <label>Annual gross margin</label>
            <div class="metric"><div id="gmTreat" class="value">n/a</div></div>
          </div>
        </div>
      </div>
    </div>

    <hr />

    <h3>Ranking of treatments</h3>
    <p class="small muted">
      Treatments are ranked by benefit cost ratio using the current base case assumptions.
    </p>
    <div id="treatmentSummary" class="item-list"></div>

    <hr />

    <h3>Net present value by analysis horizon</h3>
    <div class="row-2">
      <div class="field">
        <div class="table-scroll">
          <table id="timeProjectionTable" class="summary-table">
            <thead>
              <tr>
                <th>Years</th>
                <th>PV benefits</th>
                <th>PV costs</th>
                <th>NPV</th>
                <th>BCR</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div class="field">
        <canvas id="timeNpvChart" width="480" height="260"></canvas>
      </div>
    </div>

    <hr />

    <h3>Depreciation summary for capital items</h3>
    <div id="depSummary"></div>

    <div class="results-footer">
      <button id="exportCsv" class="btn">Export CSV</button>
      <button id="exportPdf" class="btn ghost">Print or export PDF</button>
    </div>
  </div>
</section>

<!-- SIMULATION TAB -->
<section class="tab-panel" id="tab-simulation" data-tab-panel="simulation" aria-hidden="true">
  <div class="card">
    <div class="results-header">
      <h2>Monte Carlo simulation</h2>
      <button id="runSim" class="btn primary" data-action="run-sim">
        Run simulation
      </button>
    </div>

    <p class="small muted">
      The simulation varies discount rates, adoption, risk, and optional cost and benefit
      inputs within the ranges set in the Settings tab.
    </p>

    <div class="row-4">
      <div class="field">
        <label for="simN">Number of runs</label>
        <input id="simN" type="number" min="100" step="100" />
      </div>
      <div class="field">
        <label for="targetBCR">Target BCR for success</label>
        <input id="targetBCR" type="number" step="0.1" min="0" />
        <div class="small muted">
          Current target: <span id="simBcrTargetLabel">2</span>
        </div>
      </div>
      <div class="field">
        <label for="bcrMode">BCR denominator</label>
        <select id="bcrMode">
          <option value="all">All costs</option>
          <option value="constrained">Constrained costs only</option>
        </select>
      </div>
      <div class="field">
        <label for="randSeed">Random seed (optional)</label>
        <input id="randSeed" type="number" />
      </div>
    </div>

    <h3>Variation settings</h3>
    <div class="row-4">
      <div class="field">
        <label for="simVarPct">Variation size (percent)</label>
        <input id="simVarPct" type="number" step="1" min="0" max="100" />
      </div>
      <div class="field">
        <label for="simVaryOutputs">Vary output values</label>
        <select id="simVaryOutputs">
          <option value="true">Yes</option>
          <option value="false">No</option>
        </select>
      </div>
      <div class="field">
        <label for="simVaryTreatCosts">Vary treatment costs</label>
        <select id="simVaryTreatCosts">
          <option value="true">Yes</option>
          <option value="false">No</option>
        </select>
      </div>
      <div class="field">
        <label for="simVaryInputCosts">Vary other project costs</label>
        <select id="simVaryInputCosts">
          <option value="true">Yes</option>
          <option value="false">No</option>
        </select>
      </div>
    </div>

    <div class="field">
      <div id="simStatus" class="small muted">Simulation not run yet.</div>
    </div>

    <hr />

    <h3>Simulation summary</h3>
    <div class="row-2">
      <div class="card subtle">
        <h4>Net present value</h4>
        <div class="row-4 metrics-grid">
          <div class="field">
            <label>Minimum</label>
            <div class="metric"><div id="simNpvMin" class="value">n/a</div></div>
          </div>
          <div class="field">
            <label>Maximum</label>
            <div class="metric"><div id="simNpvMax" class="value">n/a</div></div>
          </div>
          <div class="field">
            <label>Mean</label>
            <div class="metric"><div id="simNpvMean" class="value">n/a</div></div>
          </div>
          <div class="field">
            <label>Median</label>
            <div class="metric"><div id="simNpvMedian" class="value">n/a</div></div>
          </div>
        </div>
        <div class="row-2 metrics-grid">
          <div class="field">
            <label>Probability NPV > 0</label>
            <div class="metric"><div id="simNpvProb" class="value">n/a</div></div>
          </div>
        </div>
      </div>

      <div class="card subtle">
        <h4>Benefit cost ratio</h4>
        <div class="row-4 metrics-grid">
          <div class="field">
            <label>Minimum</label>
            <div class="metric"><div id="simBcrMin" class="value">n/a</div></div>
          </div>
          <div class="field">
            <label>Maximum</label>
            <div class="metric"><div id="simBcrMax" class="value">n/a</div></div>
          </div>
          <div class="field">
            <label>Mean</label>
            <div class="metric"><div id="simBcrMean" class="value">n/a</div></div>
          </div>
          <div class="field">
            <label>Median</label>
            <div class="metric"><div id="simBcrMedian" class="value">n/a</div></div>
          </div>
        </div>
        <div class="row-3 metrics-grid">
          <div class="field">
            <label>Probability BCR > 1</label>
            <div class="metric"><div id="simBcrProb1" class="value">n/a</div></div>
          </div>
          <div class="field">
            <label>Probability BCR &gt; target</label>
            <div class="metric"><div id="simBcrProbTarget" class="value">n/a</div></div>
          </div>
          <div class="field"></div>
        </div>
      </div>
    </div>

    <hr />

    <h3>Distributions</h3>
    <div class="row-2">
      <div class="field">
        <canvas id="histNpv" width="480" height="260"></canvas>
      </div>
      <div class="field">
        <canvas id="histBcr" width="480" height="260"></canvas>
      </div>
    </div>
  </div>
</section>

<!-- EXCEL TAB -->
<section class="tab-panel" id="tab-excel" data-tab-panel="excel" aria-hidden="true">
  <div class="card">
    <h2>Excel import and export</h2>
    <p>
      You can export a template or a sample workbook, populate it in Excel, and import it back
      into the tool. Optional raw plot data can be added on a dedicated sheet and used to
      calibrate treatments.
    </p>

    <div class="row-2">
      <div class="field">
        <h3>Templates</h3>
        <button id="downloadTemplate" class="btn">Download blank template</button>
        <button id="downloadSample" class="btn ghost">
          Download sample based on current scenario
        </button>
      </div>
      <div class="field">
        <h3>Import from Excel</h3>
        <p class="small muted">
          First parse the workbook, then commit the parsed data into the model once you are
          satisfied that the structure is read correctly.
        </p>
        <button id="parseExcel" class="btn">Parse Excel file</button>
        <button id="importExcel" class="btn ghost">
          Apply parsed Excel data to the model
        </button>
      </div>
    </div>

    <p class="small muted">
      Excel import and export features rely on the SheetJS XLSX library loaded in the page. If
      the library is not present, the tool will prompt you.
    </p>
  </div>
</section>

<!-- COPILOT TAB -->
<section class="tab-panel" id="tab-copilot" data-tab-panel="copilot" aria-hidden="true">
  <div class="card">
    <h2>Policy brief helper</h2>
    <p>
      This tab prepares a structured summary that can be copied into a separate AI assistant to
      draft a policy note or briefing. The content reflects the current settings and results.
    </p>
    <div class="row-2">
      <div class="field">
        <button id="openCopilot" class="btn primary">
          Copy scenario summary for policy brief
        </button>
        <p class="small muted">
          Clicking this button copies a structured scenario description to your clipboard. Paste
          it into your preferred assistant and ask for a policy brief that fits your audience.
        </p>
      </div>
      <div class="field">
        <label>Preview of JSON payload</label>
        <textarea id="copilotPreview" rows="12" readonly class="mono"></textarea>
      </div>
    </div>
  </div>
</section>


  </main>

  <footer class="app-footer">
    <div class="footer-left">
      <span class="small muted">Farming CBA Decision Aid, Newcastle Business School</span>
    </div>
    <div class="footer-right">
      <button id="exportCsvFoot" class="btn small">Export CSV</button>
      <button id="exportPdfFoot" class="btn small ghost">Print or PDF</button>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <script src="app.js"></script>

</body>
</html>
