<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Farming CBA Decision Tool 2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />

  <!-- SheetJS for Excel handling -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.20.0/xlsx.full.min.js"
          integrity="sha512-+C0p7GQGE3zHIl5tv2F6wyxtoyZLr2Jo9wN9uVtzszH5g9nB+3By8KWNm6JyoKc3fXzqX6SsEhWwBW0wE36+tA=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer"></script>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="app-title-block">
        <div class="app-logo-circle">F</div>
        <div>
          <h1>Farming CBA Decision Tool 2</h1>
          <p class="app-subtitle">
            Snapshot cost–benefit comparison of soil treatments with Excel-first workflow and AI-assisted interpretation.
          </p>
        </div>
      </div>
      <div class="app-header-right">
        <button class="btn btn-ghost" id="btn-print">Print / Save as PDF</button>
      </div>
    </header>

    <nav class="tab-bar">
      <button class="tab-button active" data-tab="scenario">1. Scenario &amp; data</button>
      <button class="tab-button" data-tab="treatments">2. Treatments &amp; costs</button>
      <button class="tab-button" data-tab="results">3. Results snapshot</button>
      <button class="tab-button" data-tab="ai">4. AI helper</button>
      <button class="tab-button" data-tab="exports">5. Export &amp; help</button>
    </nav>

    <main class="tab-container">
      <!-- Scenario & data -->
      <section class="tab-panel active" data-tab="scenario">
        <div class="panel-grid">
          <section class="card">
            <h2>Scenario settings</h2>
            <div class="form-grid">
              <label>
                Farm area (ha)
                <input type="number" id="input-area" min="1" step="1" value="100" />
              </label>
              <label>
                Time horizon (years)
                <input type="number" id="input-horizon" min="1" step="1" value="10" />
              </label>
              <label>
                Discount rate (% per year)
                <input type="number" id="input-discount" min="0" step="0.1" value="7" />
              </label>
              <label>
                Grain price ($/tonne, default)
                <input type="number" id="input-price" min="0" step="1" value="450" />
              </label>
            </div>
            <p class="helper-text">
              These settings apply to all treatments. The grain price can be overridden for a specific treatment on the
              treatments tab.
            </p>
          </section>

          <section class="card">
            <h2>Upload Faba bean dataset (actual Excel)</h2>
            <p class="helper-text">
              Upload your existing Faba bean production cost dataset exactly as it is.
              The tool will treat the first sheet as the data source and use the original columns without changes.
              It expects at least the columns <code>Amendment</code>, <code>Yield t/ha</code> and
              <code>Treatment Input Cost Only /Ha</code>, plus the other columns you have.
            </p>
            <div class="upload-block">
              <label class="file-label">
                <span>Select Excel file</span>
                <input type="file" id="input-upload" accept=".xlsx,.xls" />
              </label>
            </div>
            <p class="helper-text" id="upload-status"></p>
          </section>
        </div>
      </section>

      <!-- Treatments & costs -->
      <section class="tab-panel" data-tab="treatments">
        <section class="card">
          <div class="card-header-row">
            <h2>Treatments and cost components</h2>
            <button class="btn btn-secondary btn-small" id="btn-add-treatment">Add treatment</button>
          </div>
          <p class="helper-text">
            Each row is a treatment. At least one should be marked as <strong>Control</strong>.
            Capital cost (year 0) comes before annual costs. Total cost per hectare is calculated dynamically from the
            cost components.
          </p>
          <div class="table-wrapper">
            <table class="data-table" id="treatments-table">
              <thead>
              <tr>
                <th>Name</th>
                <th>Control?</th>
                <th>Yield (t/ha)</th>
                <th>Price ($/t)</th>
                <th>Capital cost ($/ha, year 0)</th>
                <th>Seed &amp; fertiliser ($/ha/yr)</th>
                <th>Chemicals ($/ha/yr)</th>
                <th>Labour ($/ha/yr)</th>
                <th>Machinery ($/ha/yr)</th>
                <th>Other costs ($/ha/yr)</th>
                <th>
                  <span class="indicator-label">
                    Total cost ($/ha/yr)
                    <span class="tooltip-icon"
                          data-tooltip="Sum of annual variable costs per hectare across all cost components. Capital cost is handled separately in year 0.">
                      ?
                    </span>
                  </span>
                </th>
                <th>
                  Extra benefits ($/ha/yr)
                  <span class="tooltip-icon"
                        data-tooltip="Annual non-yield benefits per hectare, for example grazing value or reduced risk, expressed in dollars.">
                    ?
                  </span>
                </th>
                <th></th>
              </tr>
              </thead>
              <tbody>
              <!-- filled by JS -->
              </tbody>
            </table>
          </div>
        </section>
      </section>

      <!-- Results -->
      <section class="tab-panel" data-tab="results">
        <div class="panel-grid">
          <section class="card">
            <h2>Economic snapshot (per hectare)</h2>
            <p class="helper-text">
              Control is shown alongside all treatments. Indicators are per hectare; multiply by farm area for the
              whole farm. Rankings are based on NPV per hectare.
            </p>
            <div id="results-table-container" class="results-table-container"></div>
          </section>

          <section class="card">
            <h2>Headline summary</h2>
            <div id="summary-block" class="summary-block"></div>
          </section>
        </div>
      </section>

      <!-- AI helper -->
      <section class="tab-panel" data-tab="ai">
        <section class="card">
          <h2>AI-assisted interpretation prompt</h2>
          <p class="helper-text">
            This prompt is built from your current scenario and results. Copy and paste it into Copilot, ChatGPT or
            another model for a plain-English interpretation focused on decision support.
          </p>
          <div class="button-row">
            <button class="btn btn-secondary" id="btn-refresh-prompt">Refresh prompt</button>
            <button class="btn" id="btn-copy-prompt">Copy prompt</button>
            <button class="btn btn-ghost" id="btn-download-prompt">Download prompt (.txt)</button>
          </div>
          <textarea id="ai-prompt" class="prompt-textarea" rows="18"></textarea>
        </section>
      </section>

      <!-- Exports & help -->
      <section class="tab-panel" data-tab="exports">
        <section class="card">
          <h2>Export options</h2>
          <div class="button-row">
            <button class="btn" id="btn-export-excel">Export results to Excel</button>
            <button class="btn btn-secondary" id="btn-print-2">Print / Save as PDF</button>
          </div>
          <p class="helper-text">
            The Excel export includes scenario settings, treatments and key indicators (PV benefits, PV costs, NPV,
            BCR, ROI and ranking). Use your browser’s print function with “Save as PDF” for a clean PDF.
          </p>
        </section>

        <section class="card">
          <h2>Decision support, not decision rules</h2>
          <p class="helper-text">
            The tool keeps all treatments visible, including low-performing options.
            Use it to explore why some treatments underperform and what changes (lower costs, higher yields, better
            prices or practice changes) might improve them.
          </p>
        </section>
      </section>
    </main>
  </div>

  <script src="script.js"></script>
</body>
</html>
