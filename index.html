<!-- index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b3a5b" />
  <title>Farming CBA Decision Tool 2 — Faba bean trial</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <a class="skip-link" href="#main">Skip to content</a>

  <header class="app-header">
    <div class="app-brand">
      <div class="brand-mark" aria-hidden="true">N</div>
      <div class="brand-text">
        <div class="brand-title">Farming CBA Decision Tool 2</div>
        <div class="brand-subtitle">Faba bean soil amendment trial, control-centric cost–benefit analysis</div>
      </div>
    </div>

    <div class="header-actions">
      <button class="btn ghost" id="openTechnicalAppendix" title="Open the technical appendix in a new tab">Technical appendix</button>
      <button class="btn ghost" id="exportCleanedTsv" title="Export the cleaned dataset as a tab separated file">Export cleaned dataset</button>
      <button class="btn ghost" id="exportTreatmentSummaryCsv" title="Export treatment summary table as a comma separated file">Export treatment summary</button>
      <button class="btn ghost" id="exportSensitivityCsv" title="Export the full sensitivity grid as a comma separated file">Export sensitivity grid</button>
    </div>
  </header>

  <div class="app-shell">
    <aside class="app-nav" aria-label="Primary navigation">
      <nav class="nav">
        <button class="nav-item active" data-tab="results" aria-selected="true">
          <span class="nav-dot" aria-hidden="true"></span>
          Results
        </button>
        <button class="nav-item" data-tab="import" aria-selected="false">
          <span class="nav-dot" aria-hidden="true"></span>
          Import data
        </button>
        <button class="nav-item" data-tab="configuration" aria-selected="false">
          <span class="nav-dot" aria-hidden="true"></span>
          Configuration
        </button>
        <button class="nav-item" data-tab="ai" aria-selected="false">
          <span class="nav-dot" aria-hidden="true"></span>
          AI briefing
        </button>
        <button class="nav-item" data-tab="diagnostics" aria-selected="false">
          <span class="nav-dot" aria-hidden="true"></span>
          Diagnostics
        </button>

        <div class="nav-sep" aria-hidden="true"></div>

        <button class="nav-item" data-tab="project" aria-selected="false">
          <span class="nav-dot" aria-hidden="true"></span>
          Project
        </button>
        <button class="nav-item" data-tab="outputs" aria-selected="false">
          <span class="nav-dot" aria-hidden="true"></span>
          Outputs and values
        </button>
        <button class="nav-item" data-tab="treatments" aria-selected="false">
          <span class="nav-dot" aria-hidden="true"></span>
          Treatments editor
        </button>
        <button class="nav-item" data-tab="benefits" aria-selected="false">
          <span class="nav-dot" aria-hidden="true"></span>
          Additional benefits
        </button>
        <button class="nav-item" data-tab="costs" aria-selected="false">
          <span class="nav-dot" aria-hidden="true"></span>
          Other costs
        </button>
        <button class="nav-item" data-tab="simulation" aria-selected="false">
          <span class="nav-dot" aria-hidden="true"></span>
          Simulation
        </button>
      </nav>
    </aside>

    <main id="main" class="app-main">
      <!-- RESULTS -->
      <section class="tab-panel active show" id="tab-results" data-tab-panel="results" aria-hidden="false">
        <div class="page-head">
          <h1>Results</h1>
          <p class="lead">
            This view compares every treatment to the control baseline under the selected scenario. The table is control-centric and designed to be read like a spreadsheet.
          </p>
        </div>

        <div class="grid-2">
          <div class="card">
            <div class="card-header">
              <h2>Scenario settings</h2>
              <div class="card-actions">
                <button class="btn" id="recomputeTrial">Recalculate</button>
              </div>
            </div>

            <div class="card-body">
              <div class="form-grid">
                <div class="field">
                  <label for="selPrice">Grain price (Australian dollars per tonne)</label>
                  <select id="selPrice"></select>
                  <div class="help">This price drives the value of incremental yield relative to the control.</div>
                </div>

                <div class="field">
                  <label for="selDiscount">Discount rate (per year)</label>
                  <select id="selDiscount"></select>
                  <div class="help">This affects how future benefits and costs are discounted to present value.</div>
                </div>

                <div class="field">
                  <label for="selPersistence">Yield persistence pattern</label>
                  <select id="selPersistence"></select>
                  <div class="help">This describes how long the yield uplift is expected to persist after the first season.</div>
                </div>

                <div class="field">
                  <label for="selScale">View scale</label>
                  <select id="selScale">
                    <option value="per_ha">Per hectare</option>
                    <option value="ha_100">100 hectares</option>
                    <option value="ha_3300">3300 hectares</option>
                  </select>
                  <div class="help">This scales results from per hectare to whole-farm totals.</div>
                </div>

                <div class="field">
                  <label for="selFilter">Quick filter</label>
                  <select id="selFilter">
                    <option value="all">Show all treatments</option>
                    <option value="top_npv">Top 5 by net present value</option>
                    <option value="top_bcr">Top 5 by benefit to cost ratio</option>
                    <option value="improve_only">Show only improvements versus control</option>
                  </select>
                  <div class="help">This filters the leaderboard and the comparison table without changing calculations.</div>
                </div>

                <div class="field">
                  <label>Current snapshot</label>
                  <div class="mini-kpis">
                    <div class="mini-kpi">
                      <div class="mini-kpi-label">Treatments</div>
                      <div class="mini-kpi-value" id="kpiTreatments">–</div>
                    </div>
                    <div class="mini-kpi">
                      <div class="mini-kpi-label">Replicates</div>
                      <div class="mini-kpi-value" id="kpiReplicates">–</div>
                    </div>
                    <div class="mini-kpi">
                      <div class="mini-kpi-label">Plots</div>
                      <div class="mini-kpi-value" id="kpiPlots">–</div>
                    </div>
                  </div>
                  <div class="help" id="kpiNote">Import your full trial dataset to activate analysis.</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>What this means</h2>
            </div>
            <div class="card-body">
              <div id="whatThisMeans" class="prose">
                Import your dataset, validate it, and commit it to see a plain-language interpretation here.
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Leaderboard</h2>
            <div class="card-actions">
              <button class="btn ghost" id="copyLeaderboardCsv">Copy leaderboard as comma separated text</button>
            </div>
          </div>
          <div class="card-body">
            <div class="table-wrap" id="leaderboardWrap" aria-label="Leaderboard table">
              <div class="empty" id="leaderboardEmpty">No committed data yet.</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Comparison to control</h2>
            <div class="card-actions">
              <button class="btn ghost" id="copyComparisonCsv">Copy table as comma separated text</button>
            </div>
          </div>
          <div class="card-body">
            <div class="table-wrap wide" id="comparisonWrap" aria-label="Comparison to control table">
              <div class="empty" id="comparisonEmpty">No committed data yet.</div>
            </div>

            <details class="details">
              <summary>How costs are handled in this tool</summary>
              <div class="details-body">
                <p>
                  The dataset contains a raw amendment input cost per hectare and a raw total cost per hectare. If the raw amendment input cost is greater than 1000, the tool treats it as being stored at about one hundred times scale and divides it by one hundred. It then reconstructs total cost per hectare by replacing the raw amendment input cost with the adjusted amendment input cost, leaving all other components unchanged. A dedicated data checks panel reports where this adjustment was applied.
                </p>
              </div>
            </details>
          </div>
        </div>
      </section>

      <!-- IMPORT -->
      <section class="tab-panel" id="tab-import" data-tab-panel="import" aria-hidden="true" hidden>
        <div class="page-head">
          <h1>Import data</h1>
          <p class="lead">
            Upload or paste the trial dataset and the data dictionary. Validate first, then commit. Nothing updates until you commit.
          </p>
        </div>

        <div class="grid-2">
          <div class="card">
            <div class="card-header">
              <h2>Step 1: dataset</h2>
            </div>
            <div class="card-body">
              <div class="stack">
                <div class="field">
                  <label for="fileDataset">Upload dataset (tab separated or comma separated)</label>
                  <input id="fileDataset" type="file" accept=".tsv,.csv,.txt,text/tab-separated-values,text/csv,text/plain" />
                  <div class="help">Use the full dataset. The tool imports every column and every row.</div>
                </div>

                <div class="field">
                  <label for="pasteDataset">Or paste dataset (tab delimited)</label>
                  <textarea id="pasteDataset" rows="10" spellcheck="false" placeholder="Paste tab-delimited data here"></textarea>
                  <div class="help">If your text includes a data dictionary section then a data section, paste the whole text. The tool will detect the data block.</div>
                </div>

                <div class="row-actions">
                  <button class="btn" id="parseDataset">Validate dataset</button>
                  <button class="btn ghost" id="clearDataset">Clear</button>
                </div>

                <div class="callout" id="datasetStatus" role="status" aria-live="polite">
                  Waiting for dataset.
                </div>

                <div class="field">
                  <label>Key fields mapping</label>
                  <div class="mapping-grid">
                    <div class="map-row">
                      <div class="map-label">Treatment name</div>
                      <select id="mapTreatmentName"></select>
                    </div>
                    <div class="map-row">
                      <div class="map-label">Treatment identifier</div>
                      <select id="mapTreatmentId"></select>
                    </div>
                    <div class="map-row">
                      <div class="map-label">Replicate identifier</div>
                      <select id="mapReplicateId"></select>
                    </div>
                    <div class="map-row">
                      <div class="map-label">Yield (tonnes per hectare)</div>
                      <select id="mapYield"></select>
                    </div>
                    <div class="map-row">
                      <div class="map-label">Total cost per hectare (raw)</div>
                      <select id="mapTotalCostRaw"></select>
                    </div>
                    <div class="map-row">
                      <div class="map-label">Amendment input cost per hectare (raw)</div>
                      <select id="mapAmendCostRaw"></select>
                    </div>
                  </div>
                  <div class="help">The tool auto-suggests mappings. Change them if your future dataset uses different column names.</div>
                </div>

                <div class="row-actions">
                  <button class="btn" id="commitDataset">Commit dataset</button>
                </div>

                <div class="callout warning" id="commitNote">
                  Committing replaces the active dataset. Use export options to keep a copy of what you analysed.
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Step 2: data dictionary</h2>
            </div>
            <div class="card-body">
              <div class="stack">
                <div class="field">
                  <label for="fileDictionary">Upload data dictionary (comma separated)</label>
                  <input id="fileDictionary" type="file" accept=".csv,text/csv,text/plain" />
                  <div class="help">The dictionary is used for field labels, validation messages, and tooltips.</div>
                </div>

                <div class="field">
                  <label for="pasteDictionary">Or paste data dictionary (comma separated)</label>
                  <textarea id="pasteDictionary" rows="10" spellcheck="false" placeholder="Paste dictionary CSV here"></textarea>
                </div>

                <div class="row-actions">
                  <button class="btn" id="parseDictionary">Load dictionary</button>
                  <button class="btn ghost" id="clearDictionary">Clear</button>
                </div>

                <div class="callout" id="dictionaryStatus" role="status" aria-live="polite">
                  Dictionary not loaded.
                </div>

                <div class="card subtle">
                  <div class="card-header">
                    <h3>Preview</h3>
                  </div>
                  <div class="card-body">
                    <div class="small muted" id="dictionaryPreview">Load a dictionary to see a preview of labels and definitions.</div>
                    <div id="dictionaryPreviewTable" class="table-wrap"></div>
                  </div>
                </div>

                <details class="details">
                  <summary>What the dictionary is used for</summary>
                  <div class="details-body">
                    <p>
                      When available, the dictionary drives field labelling, validation wording, and tooltips, so that you do not need to remember what each column means. If you upload a similar dataset in the future, the tool can reuse the same dictionary, or you can upload an updated dictionary.
                    </p>
                  </div>
                </details>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Preview and validation report</h2>
            <div class="card-actions">
              <button class="btn ghost" id="copyValidation">Copy validation report</button>
            </div>
          </div>
          <div class="card-body">
            <div id="validationReport" class="prose">Validate a dataset to see the report.</div>
            <div class="table-wrap" id="previewWrap">
              <div class="empty" id="previewEmpty">No preview yet.</div>
            </div>
          </div>
        </div>
      </section>

      <!-- CONFIGURATION -->
      <section class="tab-panel" id="tab-configuration" data-tab-panel="configuration" aria-hidden="true" hidden>
        <div class="page-head">
          <h1>Configuration</h1>
          <p class="lead">
            Adjust scenario lists, yield persistence, and treatment cost recurrence. This affects discounted results and rankings, not the raw trial treatment means.
          </p>
        </div>

        <div class="grid-2">
          <div class="card">
            <div class="card-header">
              <h2>Assumptions</h2>
              <div class="card-actions">
                <button class="btn" id="applyConfig">Apply configuration</button>
              </div>
            </div>
            <div class="card-body">
              <div class="form-grid">
                <div class="field">
                  <label for="cfgHorizon">Time horizon (years)</label>
                  <input id="cfgHorizon" type="number" min="1" step="1" value="10" />
                  <div class="help">If the horizon exceeds a persistence pattern length, the tool repeats the last factor and flags it in diagnostics.</div>
                </div>

                <div class="field">
                  <label>Discount rates list</label>
                  <div class="chips">
                    <div id="rateChips" class="chip-row"></div>
                    <div class="chip-add">
                      <input id="rateAdd" type="number" step="0.001" placeholder="Add rate, for example 0.07" />
                      <button class="btn small" id="rateAddBtn">Add</button>
                    </div>
                  </div>
                  <div class="help">Rates are expressed as decimals, for example 0.07 is seven per cent.</div>
                </div>

                <div class="field">
                  <label>Grain price list</label>
                  <div class="chips">
                    <div id="priceChips" class="chip-row"></div>
                    <div class="chip-add">
                      <input id="priceAdd" type="number" step="1" placeholder="Add price, for example 450" />
                      <button class="btn small" id="priceAddBtn">Add</button>
                    </div>
                  </div>
                  <div class="help">Prices are in Australian dollars per tonne.</div>
                </div>

                <div class="field">
                  <label>Yield persistence patterns</label>
                  <div id="persistenceList" class="stack"></div>
                  <div class="subcard">
                    <div class="subcard-title">Add a new pattern</div>
                    <div class="subcard-body">
                      <div class="row-3">
                        <div class="field">
                          <label for="persName">Name</label>
                          <input id="persName" placeholder="for example 5yr_decay" />
                        </div>
                        <div class="field">
                          <label for="persVec">Factors</label>
                          <input id="persVec" placeholder="for example 1,0.8,0.6,0.4,0.2,0,0,0,0,0" />
                        </div>
                        <div class="field">
                          <label>&nbsp;</label>
                          <button class="btn" id="persAddBtn">Add pattern</button>
                        </div>
                      </div>
                      <div class="help">Factors are applied year by year to incremental yield. Use commas. The first year factor is typically one.</div>
                    </div>
                  </div>
                </div>

                <div class="field">
                  <label>Current configuration at a glance</label>
                  <div class="glance" id="configGlance">No committed data yet.</div>
                  <div class="row-actions">
                    <button class="btn ghost" id="viewResultsSummary">View results summary</button>
                    <button class="btn ghost" id="saveScenario">Save scenario</button>
                    <button class="btn ghost" id="loadScenario">Load scenario</button>
                  </div>
                  <div class="help">Scenarios are stored locally in your browser as JSON. They do not leave your computer.</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Treatment settings</h2>
            </div>
            <div class="card-body">
              <div class="help">
                Cost recurrence controls how incremental costs are treated in present value calculations. One-off applies the incremental cost upfront. Annual repeats the incremental cost each year. Custom applies a user-provided path.
              </div>
              <div class="table-wrap" id="treatmentConfigWrap">
                <div class="empty" id="treatmentConfigEmpty">Commit a dataset to configure treatments.</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- AI -->
      <section class="tab-panel" id="tab-ai" data-tab-panel="ai" aria-hidden="true" hidden>
        <div class="page-head">
          <h1>AI briefing</h1>
          <p class="lead">
            This generates a copy-ready prompt for a farmer-facing or policy-facing brief, using only the computed results and scenario settings in the tool.
          </p>
        </div>

        <div class="grid-2">
          <div class="card">
            <div class="card-header">
              <h2>Briefing prompt</h2>
              <div class="card-actions">
                <button class="btn" id="copyBriefing">Copy briefing prompt</button>
              </div>
            </div>
            <div class="card-body">
              <textarea id="briefingText" rows="18" spellcheck="false"></textarea>
              <div class="help">The text avoids abbreviations and avoids technical jargon. It is designed to be pasted into another system.</div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Results JSON</h2>
              <div class="card-actions">
                <button class="btn" id="copyResultsJson">Copy results JSON</button>
              </div>
            </div>
            <div class="card-body">
              <textarea id="resultsJson" rows="18" spellcheck="false"></textarea>
              <div class="help">This JSON contains scenario settings, treatment results, rankings, and differences versus the control.</div>
            </div>
          </div>
        </div>
      </section>

      <!-- DIAGNOSTICS -->
      <section class="tab-panel" id="tab-diagnostics" data-tab-panel="diagnostics" aria-hidden="true" hidden>
        <div class="page-head">
          <h1>Diagnostics</h1>
          <p class="lead">
            These checks help you see missing controls within replicates, missing or invalid values, cost scaling triggers, and any computation safeguards applied.
          </p>
        </div>

        <div class="grid-2">
          <div class="card">
            <div class="card-header">
              <h2>Diagnostics summary</h2>
              <div class="card-actions">
                <button class="btn ghost" id="copyDiagnostics">Copy diagnostics text</button>
              </div>
            </div>
            <div class="card-body">
              <div id="diagnosticsText" class="prose">No committed data yet.</div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Data checks: cost scaling</h2>
            </div>
            <div class="card-body">
              <div class="help">This lists which amendments triggered the amendment input cost scaling rule, with counts and summary statistics.</div>
              <div class="table-wrap" id="scalingChecksWrap">
                <div class="empty" id="scalingChecksEmpty">No committed data yet.</div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Missing values by column</h2>
          </div>
          <div class="card-body">
            <div class="table-wrap" id="missingByColumnWrap">
              <div class="empty" id="missingByColumnEmpty">No committed data yet.</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Replicates without controls</h2>
          </div>
          <div class="card-body">
            <div class="table-wrap" id="noControlWrap">
              <div class="empty" id="noControlEmpty">No committed data yet.</div>
            </div>
          </div>
        </div>
      </section>

      <!-- PROJECT (legacy, kept for existing architecture) -->
      <section class="tab-panel" id="tab-project" data-tab-panel="project" aria-hidden="true" hidden>
        <div class="page-head">
          <h1>Project</h1>
          <p class="lead">Project metadata is kept for reporting and export. It does not change the trial-based comparison calculations.</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Project details</h2>
            <div class="card-actions">
              <button class="btn ghost" id="saveProject" title="Download project settings as JSON">Download project JSON</button>
              <button class="btn ghost" id="loadProject" title="Load project settings from JSON">Load project JSON</button>
              <input id="loadFile" type="file" accept=".json,application/json" hidden />
            </div>
          </div>
          <div class="card-body">
            <div class="form-grid">
              <div class="field"><label for="projectName">Project name</label><input id="projectName" /></div>
              <div class="field"><label for="projectLead">Project lead</label><input id="projectLead" /></div>
              <div class="field"><label for="analystNames">Analysts</label><input id="analystNames" /></div>
              <div class="field"><label for="projectTeam">Team</label><input id="projectTeam" /></div>
              <div class="field"><label for="organisation">Organisation</label><input id="organisation" /></div>
              <div class="field"><label for="lastUpdated">Last updated</label><input id="lastUpdated" /></div>

              <div class="field span-2"><label for="projectSummary">Summary</label><textarea id="projectSummary" rows="4"></textarea></div>
              <div class="field span-2"><label for="projectObjectives">Objectives</label><textarea id="projectObjectives" rows="4"></textarea></div>
              <div class="field span-2"><label for="projectActivities">Activities</label><textarea id="projectActivities" rows="4"></textarea></div>
              <div class="field span-2"><label for="stakeholderGroups">Stakeholders</label><textarea id="stakeholderGroups" rows="3"></textarea></div>
              <div class="field span-2"><label for="projectGoal">Goal</label><textarea id="projectGoal" rows="3"></textarea></div>
              <div class="field span-2"><label for="withProject">With project</label><textarea id="withProject" rows="3"></textarea></div>
              <div class="field span-2"><label for="withoutProject">Without project</label><textarea id="withoutProject" rows="3"></textarea></div>

              <div class="field"><label for="contactEmail">Contact email</label><input id="contactEmail" /></div>
              <div class="field"><label for="contactPhone">Contact phone</label><input id="contactPhone" /></div>
            </div>
          </div>
        </div>
      </section>

      <!-- OUTPUTS (legacy) -->
      <section class="tab-panel" id="tab-outputs" data-tab-panel="outputs" aria-hidden="true" hidden>
        <div class="page-head">
          <h1>Outputs and values</h1>
          <p class="lead">This section is kept for the existing tool architecture. The trial-based CBA uses scenario grain prices rather than these fields.</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Outputs</h2>
            <div class="card-actions">
              <button class="btn" id="addOutput">Add output</button>
            </div>
          </div>
          <div class="card-body">
            <div id="outputsList"></div>
          </div>
        </div>
      </section>

      <!-- TREATMENTS (legacy) -->
      <section class="tab-panel" id="tab-treatments" data-tab-panel="treatments" aria-hidden="true" hidden>
        <div class="page-head">
          <h1>Treatments editor</h1>
          <p class="lead">This editor is retained for compatibility with the existing tool structure. For trial-based analysis, use Import and Configuration tabs.</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Treatments</h2>
            <div class="card-actions">
              <button class="btn" id="addTreatment">Add treatment</button>
            </div>
          </div>
          <div class="card-body">
            <div id="treatmentsList"></div>
          </div>
        </div>
      </section>

      <!-- BENEFITS (legacy) -->
      <section class="tab-panel" id="tab-benefits" data-tab-panel="benefits" aria-hidden="true" hidden>
        <div class="page-head">
          <h1>Additional benefits</h1>
          <p class="lead">Additional benefits remain available for broader project-level modelling and simulation.</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Benefits list</h2>
            <div class="card-actions">
              <button class="btn" id="addBenefit">Add benefit</button>
            </div>
          </div>
          <div class="card-body">
            <div id="benefitsList"></div>
          </div>
        </div>
      </section>

      <!-- COSTS (legacy) -->
      <section class="tab-panel" id="tab-costs" data-tab-panel="costs" aria-hidden="true" hidden>
        <div class="page-head">
          <h1>Other costs</h1>
          <p class="lead">Other costs remain available for broader project-level modelling and simulation.</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Costs list</h2>
            <div class="card-actions">
              <button class="btn" id="addCost">Add cost</button>
            </div>
          </div>
          <div class="card-body">
            <div id="costsList"></div>
          </div>
        </div>
      </section>

      <!-- SIMULATION (legacy) -->
      <section class="tab-panel" id="tab-simulation" data-tab-panel="simulation" aria-hidden="true" hidden>
        <div class="page-head">
          <h1>Simulation</h1>
          <p class="lead">Monte Carlo simulation remains available for broader project-level modelling. Trial-based sensitivity analysis is shown in Results.</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Simulation controls</h2>
            <div class="card-actions">
              <button class="btn" id="runSim">Run simulation</button>
            </div>
          </div>
          <div class="card-body">
            <div class="form-grid">
              <div class="field"><label for="simN">Runs</label><input id="simN" type="number" min="100" step="100" /></div>
              <div class="field"><label for="targetBCR">Target ratio</label><input id="targetBCR" type="number" step="0.01" /></div>
              <div class="field"><label for="bcrMode">Ratio mode</label>
                <select id="bcrMode">
                  <option value="all">All costs</option>
                  <option value="constrained">Constrained costs</option>
                </select>
              </div>
              <div class="field"><label for="randSeed">Seed (optional)</label><input id="randSeed" type="number" step="1" /></div>

              <div class="field"><label for="simVarPct">Variation (per cent)</label><input id="simVarPct" type="number" min="0" step="1" /></div>
              <div class="field"><label for="simVaryOutputs">Vary outputs?</label>
                <select id="simVaryOutputs"><option value="true">Yes</option><option value="false">No</option></select>
              </div>
              <div class="field"><label for="simVaryTreatCosts">Vary treatment costs?</label>
                <select id="simVaryTreatCosts"><option value="true">Yes</option><option value="false">No</option></select>
              </div>
              <div class="field"><label for="simVaryInputCosts">Vary other costs?</label>
                <select id="simVaryInputCosts"><option value="true">Yes</option><option value="false">No</option></select>
              </div>
            </div>

            <div class="callout" id="simStatus">Ready.</div>

            <div class="grid-2">
              <div class="card subtle">
                <div class="card-header"><h3>Net present value distribution</h3></div>
                <div class="card-body"><canvas id="histNpv" width="520" height="220"></canvas></div>
              </div>
              <div class="card subtle">
                <div class="card-header"><h3>Benefit to cost ratio distribution</h3></div>
                <div class="card-body"><canvas id="histBcr" width="520" height="220"></canvas></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <footer class="app-footer">
        <div class="muted small">
          Built for decision support. This tool explains trade-offs and uncertainty. It does not impose decision rules.
        </div>
      </footer>
    </main>
  </div>

  <div id="toast-root" class="toast-root" aria-live="polite" aria-atomic="true"></div>

  <script src="app.js"></script>
</body>
</html>
