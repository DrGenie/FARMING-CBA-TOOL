<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Faba Beans Trial – Cost–Benefit Analysis Tool</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Control-centric discounted CBA with sensitivity analysis for faba beans soil amendment trial." />
  https://fonts.googleapis.com
  https://fonts.gstatic.com
  https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap
  styles.css
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <div class="brand-mark" aria-hidden="true"></div>
      <div class="brand-text">
        <h1>Faba Beans Trial – Cost–Benefit Analysis</h1>
        <p class="muted">Newcastle Business School</p>
      </div>
    </div>
    <nav class="top-nav" aria-label="Main">
      #Results</a>
      #Data Import</a>
      #Configuration</a>
      #Data Checks</a>
      #Diagnostics</a>
      #AI Briefing</a>
      #Technical Appendix</a>
    </nav>
  </header>

  <main class="app-main">
    <!-- RESULTS TAB -->
    <section id="tab-results" class="tab-panel active" data-tab-panel="results" aria-label="Results">
      <div class="panel">
        <div class="panel-header">
          <h2>Comparison to Control</h2>
          <div class="panel-actions">
            <div class="controls-inline">
              <label for="viewScale">View:</label>
              <select id="viewScale" title="Choose per hectare or scaled totals">
                <option value="per_ha">Per hectare</option>
                <option value="ha_100">100 hectares</option>
                <option value="ha_3300">3300 hectares</option>
              </select>
              <label for="filterPrice">Price:</label>
              <select id="filterPrice"></select>
              <label for="filterRate">Discount:</label>
              <select id="filterRate"></select>
              <label for="filterPersist">Persistence:</label>
              <select id="filterPersist"></select>
              <button class="btn" id="applyScenario">Apply</button>
              <button class="btn secondary" id="resetScenario">Reset</button>
            </div>
          </div>
        </div>

        <!-- Leaderboard -->
        <div class="card">
          <div class="card-header">
            <h3>Leaderboard snapshot</h3>
            <div class="row-2">
              <div class="field">
                <label>Quick filter</label>
                <select id="leaderFilter">
                  <option value="all">Show all</option>
                  <option value="top5npv">Top 5 by NPV</option>
                  <option value="top5bcr">Top 5 by Benefit–Cost ratio</option>
                  <option value="improved">Show only improvements vs control</option>
                </select>
              </div>
              <div class="field">
                <label>&nbsp;</label>
                <button class="btn small" id="refreshLeaderboard">Refresh</button>
              </div>
            </div>
          </div>
          <div class="leaderboard" id="leaderboard"></div>
        </div>

        <!-- Plain-language interpretations -->
        <div class="card">
          <div class="card-header"><h3>What this means</h3></div>
          <div id="plainNarrative" class="narrative"></div>
        </div>

        <!-- Comparison table -->
        <div class="comp-table-wrap" role="region" aria-label="Comparison to Control table">
          <table id="compTable" class="comp-table">
            <thead id="compHead"></thead>
            <tbody id="compBody"></tbody>
          </table>
        </div>

        <div class="panel-footer">
          <div class="row-3">
            <div class="field">
              <button class="btn" id="exportResultsCsv">Export sensitivity grid (CSV)</button>
            </div>
            <div class="field">
              <button class="btn secondary" id="exportSummaryCsv">Export treatment summary (CSV)</button>
            </div>
            <div class="field">
              <button class="btn secondary" id="exportCleanTsv">Export cleaned dataset (TSV)</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- IMPORT TAB -->
    <section id="tab-import" class="tab-panel" data-tab-panel="import" aria-label="Data Import">
      <div class="panel">
        <div class="panel-header">
          <h2>Upload or paste data</h2>
          <p class="muted">
            Import the full faba beans plot dataset (TSV or CSV) and optionally the data dictionary (CSV).
            The tool validates and previews your data before committing it.
          </p>
        </div>

        <div class="card">
          <div class="card-header"><h3>Step 1 — Provide dataset</h3></div>
          <div class="row-2">
            <div class="field">
              <label for="fileData">Upload dataset (TSV/CSV)</label>
              <input type="file" id="fileData" accept=".tsv,.csv,text/tab-separated-values,text/csv" />
            </div>
            <div class="field">
              <label for="pasteData">Paste dataset (tab‑delimited)</label>
              <textarea id="pasteData" rows="8" placeholder="Paste full tab‑delimited data here"></textarea>
            </div>
          </div>
          <div class="row-2">
            <div class="field">
              <button class="btn" id="btnLoadFile">Load uploaded dataset</button>
            </div>
            <div class="field">
              <button class="btn secondary" id="btnLoadPaste">Load pasted dataset</button>
            </div>
          </div>
          <div class="row-2">
            <div class="field">
              <button class="btn tertiary" id="btnLoadEmbedded">Load embedded dataset</button>
              <small class="muted">This loads the full dataset included with this tool. [1](https://uonstaff-my.sharepoint.com/personal/mg844_newcastle_edu_au/Documents/Microsoft%20Copilot%20Chat%20Files/faba_beans_trial_clean_named.tsv)</small>
            </div>
            <div class="field">
              <button class="btn tertiary" id="btnClearData">Clear current dataset</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header"><h3>Step 2 — Provide dictionary (optional but recommended)</h3></div>
          <div class="row-2">
            <div class="field">
              <label for="fileDict">Upload dictionary (CSV)</label>
              <input type="file" id="fileDict" accept=".csv,text/csv" />
            </div>
            <div class="field">
              <label for="pasteDict">Paste dictionary (CSV)</label>
              <textarea id="pasteDict" rows="6" placeholder="Paste full dictionary CSV here"></textarea>
            </div>
          </div>
          <div class="row-2">
            <div class="field">
              <button class="btn" id="btnLoadDictFile">Load uploaded dictionary</button>
            </div>
            <div class="field">
              <button class="btn secondary" id="btnLoadDictPaste">Load pasted dictionary</button>
            </div>
          </div>
          <div class="row-2">
            <div class="field">
              <button class="btn tertiary" id="btnLoadEmbeddedDict">Load embedded dictionary</button>
              <small class="muted">Loads the full dictionary included with this tool. [2](https://uonstaff-my.sharepoint.com/personal/mg844_newcastle_edu_au/_layouts/15/Doc.aspx?sourcedoc=%7BA2A1B38E-8255-4EF4-A6E9-FE82E38B7A42%7D&file=faba_beans_trial_data_dictionary_FULL.csv&action=default&mobileredirect=true)</small>
            </div>
            <div class="field">
              <button class="btn tertiary" id="btnClearDict">Clear dictionary</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header"><h3>Step 3 — Validate</h3></div>
          <div id="validatePanel"></div>
          <div class="row-3">
            <div class="field">
              <button class="btn" id="btnValidate">Run validation</button>
            </div>
            <div class="field">
              <button class="btn secondary" id="btnPreview">Preview key fields</button>
            </div>
            <div class="field">
              <button class="btn success" id="btnCommit">Commit dataset</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header"><h3>Preview</h3></div>
          <div class="scroll-x">
            <table id="previewTable" class="summary-table"></table>
          </div>
        </div>
      </div>
    </section>

    <!-- CONFIGURATION TAB -->
    <section id="tab-configuration" class="tab-panel" data-tab-panel="configuration" aria-label="Configuration">
      <div class="panel">
        <div class="panel-header"><h2>Configuration</h2></div>

        <div class="card">
          <div class="card-header"><h3>Analysis settings</h3></div>
          <div class="row-3">
            <div class="field">
              <label for="timeHorizon">Time horizon (years)</label>
              <input type="number" id="timeHorizon" min="1" step="1" value="10" />
            </div>
            <div class="field">
              <label>Discount rates</label>
              <div class="tag-input">
                <input id="discountRates" type="text" value="0.05,0.07,0.10" />
                <small class="muted">Comma‑separated (e.g., 0.05, 0.07, 0.10)</small>
              </div>
            </div>
            <div class="field">
              <label>Grain prices (AUD/tonne)</label>
              <div class="tag-input">
                <input id="grainPrices" type="text" value="300,350,400,450,500" />
                <small class="muted">Comma‑separated</small>
              </div>
            </div>
          </div>
          <div class="row-1">
            <div class="field">
              <label>Yield persistence patterns</label>
              <div id="persistEditor" class="persist-editor"></div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header"><h3>Treatments and recurrence</h3></div>
          <div class="scroll-x">
            <table id="configTable" class="summary-table"></table>
          </div>
          <div class="row-3">
            <div class="field">
              <button class="btn" id="btnApplyConfig">Apply configuration</button>
            </div>
            <div class="field">
              <button class="btn secondary" id="btnViewSummary">View results summary</button>
            </div>
            <div class="field">
              <button class="btn secondary" id="btnSaveScenario">Save scenario</button>
              <button class="btn tertiary" id="btnLoadScenario">Load scenario</button>
            </div>
          </div>
          <div class="card-footer" id="configSummary"></div>
        </div>
      </div>
    </section>

    <!-- DATA CHECKS TAB -->
    <section id="tab-datachecks" class="tab-panel" data-tab-panel="datachecks" aria-label="Data Checks">
      <div class="panel">
        <div class="panel-header">
          <h2>Data Checks</h2>
          <p class="muted">
            Scaling rule: if the amendment input cost per hectare raw value is greater than 1000, it is interpreted as being stored at about 100× scale and divided by 100. The reconstructed total cost per hectare equals: total_cost_per_ha_raw − cost_amendment_input_per_ha_raw + scaled amendment cost per hectare.
          </p>
        </div>
        <div class="card">
          <div class="card-header"><h3>Scaling applied</h3></div>
          <div class="scroll-x">
            <table id="scalingTable" class="summary-table"></table>
          </div>
        </div>
        <div class="card">
          <div class="card-header"><h3>Missing values overview</h3></div>
          <div class="scroll-x">
            <table id="missingTable" class="summary-table"></table>
          </div>
        </div>
      </div>
    </section>

    <!-- DIAGNOSTICS TAB -->
    <section id="tab-diagnostics" class="tab-panel" data-tab-panel="diagnostics" aria-label="Diagnostics">
      <div class="panel">
        <div class="panel-header"><h2>Diagnostics</h2></div>
        <div id="diagnosticsPanel" class="report"></div>
      </div>
    </section>

    <!-- AI BRIEFING TAB -->
    <section id="tab-aibrief" class="tab-panel" data-tab-panel="aibrief" aria-label="AI Briefing">
      <div class="panel">
        <div class="panel-header"><h2>AI Briefing</h2></div>
        <div class="card">
          <div class="card-header"><h3>Copy‑ready prompt</h3></div>
          <textarea id="briefPrompt" rows="12" class="mono"></textarea>
          <div class="row-3">
            <div class="field">
              <button class="btn" id="btnCopyBrief">Copy briefing prompt</button>
            </div>
            <div class="field">
              <button class="btn secondary" id="btnCopyResultsJson">Copy results JSON</button>
            </div>
            <div class="field">
              <button class="btn tertiary" id="btnRefreshBrief">Refresh</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- TECHNICAL APPENDIX TAB (generated to standalone file as well) -->
    <section id="tab-appendix" class="tab-panel" data-tab-panel="appendix" aria-label="Technical Appendix">
      <div class="panel">
        <div class="panel-header"><h2>Technical Appendix</h2></div>
        <article id="appendixContent" class="appendix"></article>
        <div class="panel-footer">
          <button class="btn" id="btnDownloadAppendix">Download Technical Appendix (HTML)</button>
          <small class="muted">This generates a separate technical-appendix.html file that you can host alongside the tool.</small>
        </div>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <div class="foot-actions">
      <button class="btn secondary" id="exportCsvFoot">Export CSV summary</button>
      <button class="btn secondary" id="exportPdfFoot">Print / Save PDF</button>
    </div>
    <div class="muted">Cost–Benefit Analysis tool for farmers and decision makers • Accessible, control‑centric design</div>
  </footer>

  <div id="toast-root" class="toast-root" aria-live="polite" aria-atomic="true"></div>

  <!-- Existing tool dependencies (optional) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5..min.js</script>
  <!-- SheetJS only used if present for XLSX export; CSV exports work regardless -->
  https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js</script>
  <script src="app.jsody>
</html>
